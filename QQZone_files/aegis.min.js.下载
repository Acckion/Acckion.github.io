/**
 *  =============================================================================
 * @tencent/aegis-web-sdk-v2@2.3.30 (c) 2024 TencentCloud Real User Monitoring.
 * Author pumpkincai.
 * Last Release Time Tue Nov 05 2024 17:47:36 GMT+0800 (GMT+08:00).
 * Released under the MIT License.
 * Thanks for supporting RUM & Aegis!
 * =============================================================================
 **/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Aegis=t()}(this,function(){"use strict";var k,D;function H(e){this.name="__st"+(1e9*Math.random()>>>0)+k+"__",null!=e&&e.forEach(this.add,this),k+=1}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],i=0;i<n;){var o=t[i];if(e.call(r,o,i,t))return o;i+=1}}}),window.WeakSet||(k=Date.now()%1e9,H.prototype.add=function(e){var t=this.name;return e[t]||Object.defineProperty(e,t,{value:!0,writable:!0}),this},H.prototype.delete=function(e){return!!e[this.name]&&!(e[this.name]=void 0)},H.prototype.has=function(e){return!!e[this.name]},D=H,Object.defineProperty(window,"WeakSet",{value:function(e){return new D(e)}})),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(r=arguments[n]))for(var r=Object(r),i=Object.keys(Object(r)),o=0,a=i.length;o<a;o++){var s=i[o],u=Object.getOwnPropertyDescriptor(r,s);null!=u&&u.enumerable&&(t[s]=r[s])}return t}});var G=function(e,t){return(G=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},C=function(){return(C=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function F(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function u(e,a,s,u){return new(s=s||Promise)(function(n,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,i)}o((u=u.apply(e,a||[])).next())})}function c(r,i){var o,a,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!((s=0<(s=u.trys).length&&s[s.length-1])||6!==t[0]&&2!==t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))u.label=t[1];else if(6===t[0]&&u.label<s[1])u.label=s[1],s=t;else{if(!(s&&u.label<s[2])){s[2]&&u.ops.pop(),u.trys.pop();continue}u.label=s[2],u.ops.push(t)}}t=i.call(r,u)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function U(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function q(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var I,A,j,r,W,X,V,v,l={PV:"pv",AID:"aid",F_ID:"fId",ERROR:"error",DEVICE:"device",CLOSE:"close",PAGE_PERFORMANCE:"pagePerformance",WEB_VITALS:"webVitals",IE:"ie",SPA:"spa",API:"api",ASSET_SPEED:"assetSpeed",CUSTOM:"custom",SESSION:"session",BRIDGE_SPEED:"bridgeSpeed",LOAD_PACKAGE:"loadPackageSpeed"},K=["aegis.qq.com","tamaegis.com","/aegis-sdk","rumt-","/flog.core.min.js","pingfore.qq.com","pingfore.tencent.com","zhiyan.tencent-cloud.net","h.trace.qq.com","btrace.qq.com","beacon.qq.com","dmplog.qq.com","qq.com/report","svibeacon.onezapp.com","cube.weixinbridge.com","doubleclick.net","pcmgrmonitor.3g.qq.com","report.qqweb.qq.com","tpstelemetry.tencent.com","insight.cloud.tencent.com","facebook.com","facebook.net","google","yahoo.com","twitter.com","ga-audiences","report.idqqimg.com","arms-retcode.aliyuncs.com","px.effirst.com","sentry","hot-update.json","u.c.b.r.o.w.s.e.r","report.url.cn","sockjs-node","m3u8"],z=["ResizeObserver loop limit exceeded","Failed to execute 'transaction'","window.indexedDB.deleteDatabase is not a function"],J=["level","trace","tag","seq","code"],Y=["static","fetch"],Z=((o=I=I||{}).INFO="info",o.ERROR="error",o.SDK_ERROR="sdk_error",o.PROMISE_ERROR="promise_error",o.AJAX_ERROR="ajax_error",o.SCRIPT_ERROR="script_error",o.WEBSOCKET_ERROR="websocket_error",o.IMAGE_ERROR="image_error",o.CSS_ERROR="css_error",o.MEDIA_ERROR="media_error",o.REPORT="report",o.RET_ERROR="ret_error",o.BRIDGE_ERROR="brige_error",(o=A=A||{}).NORMAL="normal",o.PV="pv",o.API="api",o.CUSTOM_TIME="custom_time",o.CUSTOM_EVENT="custom_event",o.ASSETS_SPEED="assets_speed",o.PAGE_PERFORMANCE="page_performance",o.WEB_VITALS="web_vitals",o.SDK_ERROR="sdk_error",o.SESSION="session",o.BRIDGE="bridge",(o=j=j||{}).android="android",o.ios="iOS",o.windows="windows",o.macos="macOS",o.linux="linux",o.devtools="devtools",o.other="other",(o=r=r||{}).unknown="unknown",o.wifi="wifi",o.net2g="2G",o.net3g="3G",o.net4g="4G",o.net5g="5G",o.net6g="6G",0,(o=W=W||{}).PROD="production",o.DEV="development",o.GRAY="gray",o.PRE="pre",o.DAILY="daily",o.LOCAL="local",o.TEST="test",o.OTHER="others",(o=X=X||{}).ON_NEW_AEGIS="onNewAegis",o.ON_BEFORE_DESTROY="onBeforeDestroy",o.ON_DESTROYED="onDestroyed",o.ON_BEFORE_COLLECT="onBeforeCollect",o.ON_COLLECTED="onCollected",o.ON_BEFORE_PROCESS="onBeforeProcess",o.ON_PROCESSED="onProcessed",o.ON_BEFORE_SEND="onBeforeSend",o.ON_SEND="onSended",(o=V=V||{}).ON_REPORT="onReport",o.BEFORE_REPORT_SPEED="beforeReportSpeed",o.BEFORE_REPORT="beforeReport",o.ON_BEFORE_REQUEST="onBeforeRequest",(o=v=v||{}).sampleChange="sampleChange",o.destroy="destroy",o.configChange="configChange",e.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},e.prototype.on=function(e,t,n){var r;if(void 0===n&&(n=0),this)return(r=this.eventsList[e])||(this.eventsList[e]=[],r=this.eventsList[e]),-1===this.indexOf(r,t)&&r.push({name:e,type:n||0,callback:t}),this},e.prototype.one=function(e,t){this.on(e,t,1)},e.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(n){if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(e){}}return null}},e.prototype.clear=function(){this.eventsList={}},e);function e(){var a=this;this.emit=function(e,t){if(a){var n;if(null!=(r=a.eventsList[e])&&r.length)for(var r=r.slice(),i=0;i<r.length;i++){n=r[i];try{var o=n.callback.apply(a,[t]);if(1===n.type&&a.remove(e,n.callback),!1===o)break}catch(e){throw e}}return a}},this.eventsList={}}function Q(){return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,function(e){return(e^(16*Math.random()&15)>>e/4).toString(16)})}var d={generateTraceId:ee(16),generateSpanId:ee(8)},$=Array(32);function ee(t){return function(){for(var e=0;e<2*t;e++)$[e]=Math.floor(16*Math.random())+48,58<=$[e]&&($[e]+=39);return String.fromCharCode.apply(null,$.slice(0,2*t))}}function te(e){var t,n=["",""];return n="object"==typeof e&&(t=(e=function(e){for(var t=0,n=Object.keys(ne);t<n.length;t++){var r=n[t],i=e[r]||"function"==typeof e.get&&e.get(r);if(i)return[r,i]}return["",""]}(e))[0],e=e[1],t)?ne[t](e):n}var s,ne={sw8:function(e){var e=e.split("-"),t=e[1],e=e[2];return t?[atob(t),atob(e)]:["",""]},traceparent:function(e){e=e.split("-");return[e[1],e[2]]},b3:function(e){e=e.split("-");return[e[0],e[1]]},"sentry-trace":function(e){e=e.split("-");return[e[0],e[1]]}},re=(t.prototype.generate=function(e,t){if(void 0===t&&(t={}),this.url=e,!this.isUrlIgnored()&&this.isUrlInTraceUrls()&&this.traceType){switch(this.traceType){case"traceparent":this.traceId=this.createTraceparent();break;case"b3":this.traceId=this.createB3();break;case"sw8":this.traceId=this.createSw8();break;case"sentry-trace":this.traceId=this.createSentryTrace();break;default:return console.warn("this trace key "+this.traceType+" is not supported"),void(this.traceId="")}return t[this.traceType]&&(this.traceId=t[this.traceType]),{name:this.traceType,value:this.traceId}}},t.prototype.createTraceparent=function(){var e=d.generateSpanId();return"00-"+d.generateTraceId()+"-"+e+"-0"+Number(1).toString(16)},t.prototype.createB3=function(){var e=d.generateSpanId();return d.generateTraceId()+"-"+e+"-1"},t.prototype.createSw8=function(){var e=new URL(location.href),t=q(),n=q();return"1-"+String(btoa(n))+"-"+String(btoa(t))+"-1-"+String(btoa("aegis"))+"-"+String(btoa(VERSION))+"-"+String(btoa(encodeURI(location.pathname)))+"-"+String(btoa(e.host))},t.prototype.createSentryTrace=function(){var e=Q().substring(16);return Q()+"-"+e+"-1"},t.prototype.isUrlIgnored=function(){if(Array.isArray(this.ignoreUrls)&&0!==this.ignoreUrls.length)for(var e=0,t=this.ignoreUrls;e<t.length;e++){var n=t[e];if(this.urlMatches(this.url,n))return!0}return!1},t.prototype.isUrlInTraceUrls=function(){if(!this.urls)return!0;if(Array.isArray(this.urls)){if(0===this.urls.length)return!1;for(var e=0,t=this.urls;e<t.length;e++){var n=t[e];if(this.urlMatches(this.url,n))return!0}}return!1},t.prototype.urlMatches=function(e,t){return"string"==typeof t?e===t:!!e.match(t)},t);function t(e,t,n){void 0===n&&(n=null),this.traceType=e,this.ignoreUrls=t,this.urls=n}(o=s=s||{})[o.number=-1]="number",o.string="";function ie(e,t){return"string"==typeof e?e.split("?")[t?1:0]||"":e}function oe(e,t){return void 0===t&&(t=2048),null==(e=String(e).split("?")[0])?void 0:e.slice(0,t)}function ae(e){return"string"==typeof e&&/^\//.test(e)?"https:"===(null===location||void 0===location?void 0:location.protocol):/^https/.test(e)}function se(e,t,n){try{var r="function"==typeof t?t(e,null==n?void 0:n.url)||"":e;return ye(r).slice(0,102400)}catch(e){return""}}function f(e){if("string"==typeof e)return e;try{return e instanceof Error?(JSON.stringify(e,ve())||"undefined").replace(/"/gim,""):JSON.stringify(e,ve())||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}}function ue(e){if("string"==typeof e)return e;try{return JSON.stringify(e,ve())||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}}function P(t,e){return"string"!=typeof t||!t||e&&-1<t.indexOf(e)||Ee.test(t)||K.some(function(e){return-1<t.indexOf(e)})}function p(t,n,r){return u(void 0,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return"function"!=typeof t?[3,2]:[4,t.call(n,r,n)];case 1:return[2,e.sent()];case 2:return[2,r||[]]}})})}function x(e,t){if("string"==typeof t){var t=t.split("."),n=t.pop();if(n)return"object"==typeof(t=t.reduce(function(e,t){return null==e?void 0:e[t]},e))?t[n]:t}}function ce(s){function t(){var a=Date.now();s.request({url:x(s.config,"hostUrl.whiteListUrl")+"?uid="+i+"&topic="+s.config.id,payload:{},method:"GET"},function(e){var t,e=e.data||JSON.parse(e),n=e.is_in_white_list,r=e.sample_map,i=void 0===r?{}:r,r=e.server_time,o=e.start_server_time;0!==e.code?(s.sampleMap=u,s.event.emit(v.sampleChange)):(n&&s.config.whiteList?Object.keys(l).forEach(function(e){u[l[e]]=1}):(t={},Object.keys(i).forEach(function(e){t[e.replace(/(_\w)/g,function(e){return e[1].toUpperCase()})]=i[e]/100}),h(u,t)),s.sampleMap=u,s.event.emit(v.sampleChange),n=((e=Date.now())-a-(Number(r)-Number(o)))/2,o=Number(r)+n,s.serverTimeGap=Math.floor(o-e))},function(){s.sampleMap=u,s.event.emit(v.sampleChange)})}n=s,r={},Object.keys(l).forEach(function(e){var e=l[e],t=x(n.config,"sample."+e);r[e]=t});var e,n,r,u=r,i=null==(e=s.config)?void 0:e.uid;t(),s.event.on(v.configChange,function(e){e.uid!==i&&(i=e.uid,t())})}function le(e,t,n,r){return"url: "+e+"\nresdata: "+t+"\nstatus: "+n+" \nretcode: "+r}function de(e){return e.filter(function(n,r){return"static"!==(null==n?void 0:n.requestType)||!e.find(function(e,t){return(null==n?void 0:n.url)===e.url&&200===(null==n?void 0:n.status)&&r<t})})}function fe(e,t){return Array.isArray(e)?t(e.map(function(e){return t=C(C({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(f).join(" ")}),J.forEach(function(e){t[e]||delete t[e]}),t;var t})):t([C(C({},e),{msg:"string"==typeof e.msg?e.msg:f(e.msg)})])}function pe(i){if(Array.isArray(i)&&0!==i.length)return function(e,n){var r=function(t,e){t<i.length?i[t](e,function(e){return r(t+1,e)}):null!=n&&n(e)};r(0,e)};throw new TypeError("createPipeline needs at least one function param")}var n,he=["application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/x-javascript","application/ecmascript","application/vnd.mspowerpoint","application/vnd.apple.mpegurl","application/ogg","text/css","text/javascript","image","audio","video","video/mp2t"],ge=/\.(json|js|css|jpg|jpeg|png|svg|apng|webp|gif|bmp|mp4|mp3|ts|mpeg|wav|webm|ogg|flv|m3u8|ttf|woff2|otf|eot|woff|html|htm|shtml|shtm|)$/gi,me=["ret","retcode","code","errcode"],ve=function(){var n=new WeakSet;return function(e,t){if(t instanceof Error)return"Error.message: "+t.message+" \n  Error.stack: "+t.stack;if("object"==typeof t&&null!==t){if(n.has(t))return"[Circular "+(e||"root")+"]";n.add(t)}return t}},ye=function(n,r){void 0===r&&(r=3);var i,o,a,s="";return Array.isArray(n)?(s+="[",i=n.length,n.forEach(function(e,t){s=(s+="object"==typeof e&&1<r?ye(e,r-1):be(e))+(t===i-1?"":",")}),s+="]"):n instanceof Object?(s="{",o=Object.keys(n),a=o.length,o.forEach(function(e,t){"object"==typeof n[e]&&1<r?s+='"'+e+'":'+ye(n[e],r-1):s+=we(e,n[e]),s+=t===a-1||t<a-1&&void 0===n[o[t+1]]?"":","}),s+="}"):s+=n,s},we=function(e,t){var n=typeof t,r="";return"string"==n||"object"==n?r+='"'+e+'":"'+t+'"':"function"==typeof t?r+='"'+e+'":"function '+t.name+'"':"symbol"==typeof t?r+='"'+e+'":"symbol"':"number"!=typeof t&&"boolean"!=n||(r+='"'+e+'": '+t),r},be=function(e){var t=typeof e;return""+("undefined"==t||"symbol"==t||"function"==t?"null":"string"==t||"object"==t?'"'+e+'"':e)},Ee=/data:(image|text|application|font)\/.*;base64/,h=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!t.length)return e;var r,i=t.shift();for(r in i)"object"==typeof i[r]&&null!==i[r]&&e.hasOwnProperty(r)&&"object"==typeof e[r]&&null!==e[r]?h(e[r],i[r]):e[r]=i[r];return h.apply(void 0,U([e],t))},Te=(i.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},i.prototype.unPatch=function(e){var t=this.instances.indexOf(e);-1!==t&&(this.instances.splice(t,1),0===this.instances.length)&&this.uninstall(e)},i.prototype.countInstance=function(){return this.instances.length},i.prototype.uninstall=function(e){var t;null!=(t=null==(t=e.option)?void 0:t.destroy)&&t.call(e.option,this.aegis,this.getConfig(e))},i.prototype.walk=function(t){var n=this;this.instances.forEach(function(e){n.canUse(e)&&t(e,n.getConfig(e))})},i.prototype.canUse=function(e){return!e||!(!(e=this.getConfig(e))||"object"!=typeof e)||!!e},i.prototype.getConfig=function(e){var t;return null!=(t=null==(t=this.config)?void 0:t[e.name])?t:null==(t=this.aegis.config)?void 0:t[e.name]},i.prototype.exist=function(e){return-1===this.instances.indexOf(e)},i.prototype.triggerInit=function(e){var t;this.initializedPlugin[e.name]||(e.option.aegis=this.aegis,e.aegis=this.aegis,this.initializedPlugin[e.name]=!0,null==(t=null==(t=e.option)?void 0:t.init))||t.call(e.option,this.aegis,this.getConfig(e))},i.prototype.triggerOnNewAegis=function(e){var t;p(this.aegis.config.onBeforeCollect,this.aegis),null!=(t=null==(t=e.option)?void 0:t.onNewAegis)&&t.call(e.option,this.aegis,this.getConfig(e))},i),Se={name:"sample",create:function(i){var o=Math.random();return function(e,t){var n=i.sampleMap,r=i.config.forceReportErrorLog,e=e.filter(function(e){return!e.plugin||!((!r||![I.ERROR,I.PROMISE_ERROR,I.AJAX_ERROR,I.SCRIPT_ERROR,I.IMAGE_ERROR,I.CSS_ERROR,I.MEDIA_ERROR,I.WEBSOCKET_ERROR,I.BRIDGE_ERROR,I.SDK_ERROR].includes(e.level))&&(e=e.plugin===l.SPA?l.PV:e.plugin,void 0!==(e=n[e]))&&e<o)});0<e.length&&t(e)}}},Re={name:"throttle",create:function(n,r){var i,o=[],a=n.config;return n.event.on(v.destroy,function(){o.length=0}),function(e,t){o=o.concat(e),r&&o.length>=r||n.sendNow&&0<o.length?(o=de(o),t(o.splice(0,o.length)),i&&clearTimeout(i)):(i&&clearTimeout(i),i=setTimeout(function(){i=null,0<(o=de(o)).length&&t(o.splice(0,o.length))},a.delay))}}},Oe={name:"format",create:function(){return fe}},Ce={name:"lengthLimit",create:function(n){return function(e,t){var r=n.config;t(e=e.map(function(e){var t,n=r.maxLength||102400;try{if(!e.msg||e.msg.length<=n)return e;e.msg=null==(t=e.msg)?void 0:t.substring(0,n)}catch(t){e.msg=f(e.msg).substring(0,r.maxLength)}return e}))}}},Ie={},Ae={},Pe={name:"repeatLimit",create:function(e){return n=e.config,function(e,t){var r,i,o="number"==typeof n.repeat?n.repeat:60;!x(n,"sample.speed")||o<=0?t(e):(r=(null==n?void 0:n.id)||"0",i=Ae[r]||{},(e=e.filter(function(e){var t,n=!i[e.url]||i[e.url]<o;return n?(i[e.url]=1+~~i[e.url],Ae[r]=i):Ie[r]||(Ie[t=r]||(Ie[t]=setTimeout(function(){Ae[t]={},Ie[t]=null},6e4))),n})).length&&t(e))};var n}};function i(e,t){this.instances=[],this.initializedPlugin={},this.aegis=e,this.config=t}(o=n=n||{})[o.ERROR=0]="ERROR",o[o.WARN=1]="WARN",o[o.INFO=2]="INFO",o[o.DEBUG=3]="DEBUG";function xe(t,n){Object.getOwnPropertyNames(t).forEach(function(e){"function"==typeof t[e]&&"constructor"!==e&&(n?n[e]="sendPipeline"===e?function(){return function(){}}:function(){}:t[e]=function(){})})}function Be(e,t){return t(e)}function Ne(){return void 0!==window.performance&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}function Le(t,n){function r(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||(t(e),n&&(removeEventListener("visibilitychange",r,!0),removeEventListener("pagehide",r,!0)))}addEventListener("visibilitychange",r,!0),addEventListener("pagehide",r,!0)}function Me(e){switch(e){case"script":return"js";case"link":return"css";default:return e}}function _e(){var e;return!(null==(e=window.external)||!e.assetsGC)}m.prototype.debug=function(e){this.log(n.DEBUG,e)},m.prototype.info=function(e){this.log(n.INFO,e)},m.prototype.warn=function(e){this.log(n.WARN,e)},m.prototype.error=function(e){this.log(n.ERROR,e)},m.prototype.log=function(e,t){e<=this.logLevel&&console.log("["+n[e]+"] "+t)};var ke,De=m,o=(g.prototype.init=function(){var t=this;this.logger=new De(this.config.env===W.PROD?n.ERROR:n.DEBUG),ce(this),this.plugin=new Te(this,this.config.plugin),g.installedPlugins.forEach(function(e){t.plugin.patch(e)}),this.event.emit("init")},g.prototype.setConfig=function(e){return h(this.config,e),this.extendBean(this.config),this.event.emit(v.configChange,e),p(this.config.onConfigChange,this),this.config},g.use=function(e){-1===g.installedPlugins.indexOf(e)&&g.installedPlugins.push(e)},g.unuse=function(e){e=g.installedPlugins.indexOf(e);-1!==e&&g.installedPlugins.splice(e,1)},g.prototype.sendCustomLogs=function(e,t,n){var r,i,o,a=this;this.canUseCustomPlugin()&&(p(this.config.onBeforeCollect,this),r=t,i=n,o=l.CUSTOM,void 0===r&&(r=I.INFO),void 0===i&&(i=A.NORMAL),void 0===o&&(o=l.CUSTOM),t=e.map(function(e){var t="object"==typeof e?e:{msg:e};return C(C({},t),{msg:t instanceof Error?f(t):t.msg||"",level:null!=r?r:e.level,type:null!=i?i:e.type,plugin:null!=o?o:e.plugin})}).map(function(e){return C(C({},e),{timestamp:Date.now(),snapshootInfo:JSON.stringify(a.snapshootInfo)})}),this.send(t),p(this.config.onCollected,this,t))},g.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.sendCustomLogs(e,I.INFO)},g.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.sendCustomLogs(e,I.REPORT)},g.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.sendCustomLogs(e,I.ERROR)},g.prototype.clearPluginCache=function(){this.plugin.instances.forEach(function(e){var t;null!=(t=null==(t=e.option)?void 0:t.clear)&&t.call(e.option,e)})},g.prototype.clearThrottleCache=function(){this.sendNow=!0,this.send([]),this.sendNow=!1},g.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,msg:"report_event",level:I.INFO,plugin:l.CUSTOM}:e).name?("string"!=typeof e.name&&(this.logger.warn("reportEvent params name must be string"),e.name=String(e.name)),this.sendCustomLogs([e],I.INFO,A.CUSTOM_EVENT)):this.logger.warn("reportEvent params error"))},g.prototype.canUseCustomPlugin=function(){var e;return!1!==(null==(e=this.config.plugin)?void 0:e[l.CUSTOM])},g.prototype.reportTime=function(e,t){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof t?t<0||6e4<t?this.logger.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,t):this.logger.warn("reportTime: second param must be number"):this.logger.warn("reportTime: first param must be a string")},g.prototype.reportT=function(e){var t=e.name,n=e.duration,e=F(e,["name","duration"]);if("string"==typeof t&&"number"==typeof n){if(!(n<0||6e4<n))return this.submitCustomTime(t,n,e);this.logger.warn("reportTime: duration must between 0 and 60000")}else this.logger.warn("reportTime: params error")},g.prototype.time=function(e,t){"string"==typeof e?this.timeMap[e]?this.logger.warn("Timer "+e+" already exists"):this.timeMap[e]={startTime:Date.now(),customParams:t}:this.logger.warn("time: first param must be a string")},g.prototype.timeEnd=function(e,t){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e].startTime,C(C({},this.timeMap[e].customParams),t)),delete this.timeMap[e]):this.logger.warn("Timer "+e+" does not exist"):this.logger.warn("timeEnd: first param must be a string")},g.prototype.submitCustomTime=function(e,t,n){this.sendCustomLogs([C({name:e,duration:t,msg:"custom_time",plugin:l.CUSTOM},n)],I.INFO,A.CUSTOM_TIME)},g.prototype.updateSnapshootInfo=function(e){h(this.snapshootInfo,e)},g.prototype.extendBean=function(e){var t,e={id:null!=(t=e.id)?t:this.bean.id,uid:null!=(t=e.uid)?t:this.bean.uid,version:null!=(t=e.version)?t:this.bean.version,aid:null!=(t=e.aid)?t:this.bean.aid,env:null!=(t=e.env)?t:this.bean.env,platform:null!=(t=e.platform)?t:this.bean.platform,netType:null!=(t=e.netType)?t:this.bean.netType,vp:null!=(t=e.vp)?t:this.bean.vp,sr:null!=(t=e.sr)?t:this.bean.sr,sessionId:null!=(t=e.sessionId)?t:this.bean.sessionId,from:null!=(t=e.from)?t:this.bean.from,referer:null!=(t=e.referer)?t:this.bean.referer};h(this.bean,e)},g.prototype.generateRequestOptionsByLogs=function(e){var r=this;return{payload:{topic:this.config.id||"",data:e.map(function(t){var e=t.type,n=t.snapshootInfo;return["type","snapshootInfo"].forEach(function(e){delete t[e]}),{message:ue(C(C(C({},r.config.extField||{}),t),{timestamp:t.timestamp+r.serverTimeGap})),fields:ue(C(C(C({},r.bean),{type:e}),n?JSON.parse(n):{})),timestamp:Date.now()+r.serverTimeGap}})}}},g.prototype.send=function(e,i,o){var r,a,s=this;return this.sendPipeline||(this.sendPipeline=pe([(a=[],(r=this).event.on(v.destroy,function(){a.length=0}),function(e,t){var n;null!=(n=null==r?void 0:r.canProceedLogs)&&n.call(r)?(0<a.length&&(e.push.apply(e,a),a.length=0),0<e.length&&t(e)):a=a.concat(e)}),Re.create(this),Se.create(this),function(n,r){return u(s,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=r,[4,p(this.config.onBeforeSend,this,n)];case 1:return t.apply(void 0,[e.sent()]),[2]}})})},function(n,r){var e;0!==n.length&&(e=s.generateRequestOptionsByLogs(n),s.request(e,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.failRequestCount=0,r(U(n,[{isErr:!1,result:e}])),null!=i&&i.apply(void 0,e)},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];60<=++s.failRequestCount&&s.destroy(),r(U(n,[{isErr:!0,result:e}])),null!=o&&o.apply(void 0,e)}))},function(n,r){return u(s,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=r,[4,p(this.config.onSended,this,n)];case 1:return t.apply(void 0,[e.sent()]),[2]}})})}])),this.sendPipeline(e)},g.prototype.ready=function(e,t,n){throw new Error('You need to override "ready" method')},g.prototype.request=function(e,t,n){throw new Error('You need to override "request" method')},g.prototype.sendSDKError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.sendCustomLogs(e,I.SDK_ERROR,A.SDK_ERROR)},g.prototype.destroy=function(s){return void 0===s&&(s=!1),u(this,void 0,void 0,function(){var r,i,o,a;return c(this,function(e){switch(e.label){case 0:return[4,p(this.config.onBeforeDestroy,this)];case 1:for(e.sent(),-1!==(a=g.instances.indexOf(this))&&g.instances.splice(a,1),r=g.installedPlugins.length-1;0<=r;r--)try{i=g.installedPlugins[r],this.plugin.unPatch(i)}catch(e){this.sendSDKError({msg:f(e)})}if(this.event.emit("destroy"),this.event.clear(),s)t=this,n=Object.getOwnPropertyDescriptors(t),Object.keys(n).forEach(function(e){n[e].writable&&(t[e]=null)}),Object.setPrototypeOf(this,null);else{for(o=this;o.constructor!==Object&&xe(o,this),o=Object.getPrototypeOf(o););0===g.instances.length&&(a=Object.getPrototypeOf(this).constructor,xe(a),xe(g))}return p(this.config.onDestroyed,this),[2]}var t,n})})},g.prototype.canProceedLogs=function(){return!0},g.version="2.3.30",g.instances=[],g.logLevel=I,g.environment=W,g.installedPlugins=[],g),a=(Fe.prototype.getConfig=function(){var e;return null!=(e=null==(e=this.aegis.config)?void 0:e[this.name])?e:null==(e=this.aegis.config)?void 0:e[this.name]},Fe.prototype.publish=function(e,t){var i=this,o=t||this.aegis;return!!o.plugin.canUse(this)&&(t=(Array.isArray(e)?e:[e]).map(function(e){var t;return C(C({},e),{plugin:i.name,type:null!=(t=e.type)?t:A.NORMAL,level:null!=(t=e.level)?t:I.INFO,timestamp:Date.now(),snapshootInfo:ue(o.snapshootInfo)})}),p(o.config.onCollected,o,t),null!=(e=this.option.pipes)&&e.length?(this.pipeline||((e=this.option.pipes.map(function(e){return i.wrapPipe(e,o)})).unshift(function(n,r){return u(i,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=r,[4,p(o.config.onBeforeProcess,o,n)];case 1:return t.apply(void 0,[e.sent()]),[2]}})})}),e.push(function(n,r){return u(i,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=r,[4,p(o.config.onProcessed,o,n)];case 1:return t.apply(void 0,[e.sent()]),[2]}})})}),e.push(function(e,t){o.send(e),t(e)}),this.pipeline=pe(e)),this.pipeline(t)):o.send(t),!0)},Fe.prototype.wrapPipe=function(t,e){var n,r,i,o;return"string"==typeof t?null!=(i=null==(i=e.pipes.find(function(e){return e.name===t}))?void 0:i.create(e))?i:Be:(i=null!=(i=t)?i:{},n=i.name,r=i.option,i=i.create,"string"!=typeof n?t:(o=e.pipes.find(function(e){return e.name===n}),null!=(i=null!=(i=null==i?void 0:i(e,r))?i:null==o?void 0:o.create(e,r))?i:Be))},Fe),He=new a({name:l.AID,aid:"",init:function(e){var t;try{var n=null==(t=e.config.plugin)?void 0:t.aid,r="string"==typeof n?n:window.localStorage.getItem("AEGIS_ID");r||(r=q(),window.localStorage.setItem("AEGIS_ID",r)),this.aid=r}catch(e){}},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}}),Ge=(new a({name:l.ASSET_SPEED}),new a({name:l.ASSET_SPEED,pipes:["repeatLimit","networkRefresh"],collectCur:0,collectEntryType:"resource",ASSETS_INITIATOR_TYPE:["img","css","script","link","audio","video"],observer:null,onNewAegis:function(e){var t=this;Ne()&&(this.collectSuccessLog(e),this.collectFailLog(e),performance.onresourcetimingbufferfull=function(){"function"==typeof performance.clearResourceTimings&&(t.collectCur=0,performance.clearResourceTimings())})},publishMany:function(e,t){for(var n=t.config,r=0,i=e.length;r<i;r++){var o=e[r];-1===this.ASSETS_INITIATOR_TYPE.indexOf(o.initiatorType)||P(o.name,x(n,"hostUrl.url"))||this.publish(this.generateLog(o,n),t)}},collectSuccessLog:function(n){var e,r=this;"function"==typeof(null===window||void 0===window?void 0:window.PerformanceObserver)?(this.publishMany(performance.getEntriesByType(this.collectEntryType),n),this.observer=new window.PerformanceObserver(function(e){r.publishMany(e.getEntries(),n)}),this.observer.observe({entryTypes:[this.collectEntryType]}),n.event.on(v.destroy,function(){var e;null!=(e=r.observer)&&e.disconnect()})):(e=setInterval(function(){var e=performance.getEntriesByType(r.collectEntryType),t=e.slice(r.collectCur);r.collectCur=e.length,r.publishMany(t,n)},3e3),n.event.on(v.destroy,function(){clearInterval(e)}))},collectFailLog:function(i){function e(e){var t,n,r;e&&(e=e.target||e.srcElement,!(t=(null==e?void 0:e.src)||(null==e?void 0:e.href))||"string"!=typeof t||-1<window.location.href.indexOf(t)||(e=performance.getEntriesByType(o.collectEntryType).find(function(e){return e.name===t}),n="function"==typeof(n=(null==(n=a.plugin)?void 0:n.api).resourceTypeHandler)?n(t):Me(null==e?void 0:e.initiatorType),P(t,x(a,"hostUrl.url")))||(r="function"==typeof(r=(null==(r=a.plugin)?void 0:r.assetSpeed).urlHandler)?r(t):t,r={msg:"static_fail",errorMsg:"load "+oe(t)+" fail",url:oe(r),status:400,duration:Number(((null==e?void 0:e.duration)||0).toFixed(2)),method:"get",assetType:n||"static",isHttps:ae(t),urlQuery:ie(t,!0),nextHopProtocol:"",domainLookup:s.number,connectTime:s.number,tlsTime:s.number,requestTime:s.number,responseTime:s.number,preHandleTime:s.number,tcpAndRequestGap:s.number,type:A.ASSETS_SPEED},o.publish(r,i)))}var o=this,a=i.config;window.document.addEventListener("error",e,!0),i.event.on(v.destroy,function(){window.document.removeEventListener("error",e,!0)})},generateLog:function(e,t){var n=(null==(n=t.plugin)?void 0:n.api).resourceTypeHandler,t=(null==(t=t.plugin)?void 0:t.assetSpeed).urlHandler,t="function"==typeof t?t(e.name):e.name,n="function"==typeof n?n(e.name):Me(e.initiatorType);return{msg:"asset_speed",url:oe(t),duration:Number(e.duration.toFixed(2)),status:200,assetType:n||"static",isHttps:ae(e.name),nextHopProtocol:e.nextHopProtocol||"",urlQuery:ie(e.name,!0),preHandleTime:Number((e.fetchStart-e.domainLookupEnd).toFixed(2)),domainLookup:Number((e.domainLookupEnd-e.domainLookupStart).toFixed(2)),connectTime:Number((e.connectEnd-e.connectStart).toFixed(2)),tlsTime:Number((e.requestStart-e.secureConnectionStart).toFixed(2)),tcpAndRequestGap:Number((e.requestStart-e.connectEnd).toFixed(2)),requestTime:Number((e.responseStart-e.requestStart).toFixed(2)),responseTime:Number((e.responseStart?e.responseEnd-e.responseStart:e.duration).toFixed(2)),transferSize:0<e.transferSize?e.transferSize:-1,method:"get",type:A.ASSETS_SPEED}},collectNotReportedLog:function(e){var t,n;Ne()&&(t=(n=performance.getEntriesByType(this.collectEntryType)).length,"function"!=typeof window.PerformanceObserver)&&this.collectCur!==t&&(n=n.slice(this.collectCur),this.collectCur=t,this.publishMany(n,e))},destroy:function(){var e;this.publish=function(){},null!=(e=this.observer)&&e.disconnect()}}));function Fe(e){var t;this.option=e,this.name=e.name,this.init=null==(t=e.init)?void 0:t.bind(this),this.onNewAegis=null==(t=e.onNewAegis)?void 0:t.bind(this),this.destroy=null==(t=e.destroy)?void 0:t.bind(this),this.option.$getConfig=this.getConfig.bind(this),this.option.publish=this.publish.bind(this)}function g(e){var t;this.pipes=[Se,Re,Oe,Ce,Pe],this.config={id:"",uid:"",delay:1e3,repeat:60,sample:1,env:"production",maxLength:102400,whiteList:!0,hostUrl:{url:"https://galileotelemetry.tencent.com/collect",whiteListUrl:"https://galileotelemetry.tencent.com/aegiscontrol/whitelist"},plugin:{pv:!0,aid:!0,error:!0,device:!0,close:!0,pagePerformance:!0,webVitals:!0,custom:!0,fId:!1,ie:!1,spa:!1,api:!1,assetSpeed:!1,session:!1},reportImmediately:!0,forceReportErrorLog:!1},this.event=new Z,this.bean={},this.snapshootInfo={},this.serverTimeGap=0,this.sampleMap={},this.timeMap={},this.failRequestCount=0,e.version=null!=(t=e.version)?t:"2.3.30",e.hostUrl=void 0===(t=e.hostUrl)?{}:"string"==typeof t?{url:t}:t,this.setConfig(e),g.instances.push(this),p(this.config.onNewAegis,this)}function m(e){void 0===e&&(e=n.INFO),this.logLevel=e}(st=ke=ke||{}).unknown="unknown",st.normal="normal",st.weak="weak",st.disconnected="disconnected";function y(e,t,n,r){return void 0===n&&(n=15e3),void 0===r&&(r=0),(t=void 0===t?0:t)<=e&&e<=n?e:r}function w(e,t){var n=mt(),r="navigate";return 0<=ht?r="back-forward-cache":n&&(document.prerendering||0<vt()?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}}function b(t,n,r,i){var o,a;return function(e){0<=n.value&&(e||i)&&((a=n.value-(o||0))||void 0===o)&&(o=n.value,n.delta=a,n.rating=(e=n.value)>r[1]?"poor":e>r[0]?"needs-improvement":"good",t(n))}}function Ue(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})}function qe(e){document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})}function je(e){var t=!1;return function(){t||(e(),t=!0)}}function We(){return wt<0&&(wt=bt(),Tt(),gt(function(){setTimeout(function(){wt=bt(),Tt()},0)})),{get firstHiddenTime(){return wt}}}function Xe(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()}function Ve(o,a){a=a||{},Xe(function(){var t,n=We(),r=w("FCP"),i=yt("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(i.disconnect(),e.startTime<n.firstHiddenTime)&&(r.value=Math.max(e.startTime-vt(),0),r.entries.push(e),t(!0))})});i&&(t=b(o,r,St,a.reportAllChanges),gt(function(e){r=w("FCP"),t=b(o,r,St,a.reportAllChanges),Ue(function(){r.value=performance.now()-e.timeStamp,t(!0)})}))})}function Ke(){return tt?Ot:performance.interactionCount||0}function ze(t){var e,n;Bt.forEach(function(e){return e(t)}),!t.interactionId&&"first-input"!==t.entryType||(n=R[R.length-1],((e=Pt.get(t.interactionId))||R.length<10||t.duration>n.latency)&&(e?t.duration>e.latency?(e.entries=[t],e.latency=t.duration):t.duration===e.latency&&t.startTime===e.entries[0].startTime&&e.entries.push(t):(n={id:t.interactionId,latency:t.duration,entries:[t]},Pt.set(n.id,n),R.push(n)),R.sort(function(e,t){return t.latency-e.latency}),10<R.length)&&R.splice(10).forEach(function(e){return Pt.delete(e.id)}))}function Je(e){var t=self.requestIdleCallback||self.setTimeout,n=-1;return e=je(e),"hidden"===document.visibilityState?e():(n=t(e),qe(e)),n}function Ye(o,a){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(a=a||{},Xe(function(){var e;"interactionCount"in performance||(tt=tt||yt("event",At,{type:"event",buffered:!0,durationThreshold:0}));function t(t){Je(function(){t.forEach(ze);e=Math.min(R.length-1,Math.floor((Ke()-xt)/50));var e=R[e];e&&e.latency!==n.value&&(n.value=e.latency,n.entries=e.entries,i())})}var n=w("INP"),r=yt("event",t,{durationThreshold:null!=(e=a.durationThreshold)?e:40}),i=b(o,n,Nt,a.reportAllChanges);r&&(r.observe({type:"first-input",buffered:!0}),qe(function(){t(r.takeRecords()),i(!0)}),gt(function(){xt=Ke(),R.length=0,Pt.clear(),n=w("INP"),i=b(o,n,Nt,a.reportAllChanges)}))}))}function Ze(){var t;0<=nt&&nt<rt-kt&&(t={entryType:"first-input",name:T.type,target:T.target,cancelable:T.cancelable,startTime:T.timeStamp,processingStart:T.timeStamp+nt},it.forEach(function(e){e(t)}),it=[])}function Qe(e){var t,n,r,i;function o(){Dt(n,r),i()}function a(){i()}e.cancelable&&(t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(n=t,r=e,i=function(){removeEventListener("pointerup",o,_t),removeEventListener("pointercancel",a,_t)},addEventListener("pointerup",o,_t),addEventListener("pointercancel",a,_t)):Dt(t,e))}function $e(t){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return t(e,Qe,_t)})}function et(e){var t=e.name;0<(e=e.value)&&(Gt[t]=e)}var E,tt,T,nt,rt,it,ot,at,st=new a({name:l.DEVICE,onNewAegis:function(e){e.extendBean({platform:this.getPlatform(),netType:r.unknown}),this.getDpi(e),this.refreshNetworkTypeToBean(e),this.refreshNetworkStatusToBean(e)},getDpi:function(e){e.extendBean({vp:Math.round(window.innerWidth)+" * "+Math.round(window.innerHeight)}),window.screen&&e.extendBean({sr:Math.round(window.screen.width)+" * "+Math.round(window.screen.height)})},getPlatform:function(){var t={android:/\bAndroid\s*([^;]+)/,ios:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/,windows:/\b(Windows NT|Windows)/,macos:/\b(Mac OS|OSX)/,linux:/\b(Linux)/i},e=Object.keys(t).find(function(e){return t[e].test(navigator.userAgent)});return e?j[e]:j.other},refreshNetworkTypeToBean:function(e){var n=this,t=e.config;t&&("function"==typeof t.getNetworkType?t.getNetworkType:ut)(function(t){Object.keys(r).some(function(e){return r[e]===t})||(t=r.unknown),e.extendBean({netType:t}),n.NetworkRefreshTimer=setTimeout(function(){n.refreshNetworkTypeToBean(e),clearTimeout(n.NetworkRefreshTimer)},1e4)})},refreshNetworkStatusToBean:function(e){var t,n=this,r=e.config;r&&null!=(t="function"==typeof r.getNetworkStatus?r.getNetworkStatus:t)&&t(function(t){Object.keys(ke).some(function(e){return ke[e]===t})||(t=ke.unknown),e.extendBean({netStatus:t}),n.NetworkStatusRefreshTimer=setTimeout(function(){n.refreshNetworkStatusToBean(e),clearTimeout(n.NetworkStatusRefreshTimer)},1e4)})}}),ut=function(e){var t="",n=navigator.userAgent.match(/NetType\/(\w+)/);n?t=n[1]:navigator.connection&&(t=navigator.connection.effectiveType||navigator.connection.type),e((n=t=t||"unknown",0<=(n=String(n).toLowerCase()).indexOf("4g")?r.net4g:0<=n.indexOf("wifi")?r.wifi:0<=n.indexOf("5g")?r.net5g:0<=n.indexOf("6g")?r.net6g:0<=n.indexOf("3g")?r.net3g:0<=n.indexOf("2g")?r.net2g:r.unknown))},ct=window.WebSocket,S=[],lt={construct:function(e,t){var a=new e(t[0],t[1]);return a.originSend=a.send,a.addEventListener("error",function(e){var e=(null==e?void 0:e.currentTarget)||{},t=e.url,n=e.readyState;null!=S&&S.forEach(function(e){e=e.onErr;null!=e&&e({msg:"无法获知具体错误信息，需在浏览器控制台查看！",readyState:n,connectUrl:t})})}),Object.defineProperty(a,"send",{get:function(){return function(e){null!=(t=a.originSend)&&t.call(a,e);var t=a.readyState,e=WebSocket.OPEN,n=WebSocket.CLOSED,r=WebSocket.CONNECTING,i=WebSocket.CLOSING;if(t!==e){var o={readyState:t,connectUrl:a.url};switch(t){case n:S.forEach(function(e){e=e.sendErr;null!=e&&e(C({msg:"消息发送失败，连接已关闭！"},o))});break;case r:S.forEach(function(e){(0,e.sendErr)(C({msg:"消息发送失败，正在连接中！"},o))});break;case i:S.forEach(function(e){(0,e.sendErr)(C({msg:"消息发送失败，连接正在关闭！"},o))})}}}}}),a}},dt=(new a({name:l.ERROR}),new a({name:l.ERROR,onNewAegis:function(e){this.startListen(e)},startListen:function(i){function e(e){var t,n=e&&f(e.reason);n&&s.publishErrorLog({msg:"PROMISE_ERROR: "+n,errorMsg:null==(t=null==(e=(null==(t=e.reason)?void 0:t.message)||(null==(t=e.reason)?void 0:t.errMsg)||n)?void 0:e.slice)?void 0:t.call(e,0,150),level:I.PROMISE_ERROR,type:A.NORMAL},i)}function t(e){var t;if(e=(null==e?void 0:e.target)||(null==e?void 0:e.srcElement)){var n=e.src||e.href||"",e=e.tagName,e=void 0===e?"script":e;if(!(P(t=n,x(i.config,"hostUrl.url"))||-1<window.location.href.indexOf(t))){var r={msg:e+" load fail: "+n,level:I.INFO,type:A.NORMAL};if(/\.js$/.test(n))r.level=I.SCRIPT_ERROR;else if(/\.css$/.test(n))r.level=I.CSS_ERROR;else switch(e.toLowerCase()){case"script":r.level=I.SCRIPT_ERROR;break;case"link":r.level=I.CSS_ERROR;break;case"img":r.level=I.IMAGE_ERROR;break;case"audio":case"video":r.level=I.MEDIA_ERROR;break;default:return}s.publishErrorLog(r,i)}}}var n,r,o,a,s=this,u=window.onerror;window.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n,r=f(e[0]);"string"!=typeof(n=r)||!n||z.some(function(e){return-1<n.indexOf(e)})||K.some(function(e){return-1<n.indexOf(e)})||s.publishErrorLog({msg:(r||"")+" @ ("+(f(e[1])||"")+":"+(e[2]||0)+":"+(e[3]||0)+")\n          \n"+f(e[4]||""),errorMsg:r,level:I.ERROR,type:A.NORMAL},i),null!=u&&u.call.apply(u,U([window],e))},window.addEventListener("unhandledrejection",e);window.document.addEventListener("error",t,!0),i.event.on(v.destroy,function(){window.document.removeEventListener("unhandledrejection",e),window.document.removeEventListener("error",t,!0)}),i.config.websocketHack&&(n={key:i.config.id+"-"+this.name,onErr:function(e){var t;null!=(t=s.publishWsErrorLog)&&t.call(s,e,i)},sendErr:function(e){var t;null!=(t=s.publishWsErrorLog)&&t.call(s,e,i)}},this.hackWebsocketConfig=n,n=this.hackWebsocketConfig,window.Proxy)&&window.WebSocket&&(r=window.WebSocket,window&&!r.isHack&&(o=new Proxy(WebSocket,lt),r.isHack=!0,window.WebSocket=o),a=n,S.find(function(e){return e.key===a.key})||a&&S.push(a))},publishErrorLog:function(e,t){var n=e.type,r=e.level,e=F(e,["type","level"]);this.publish(C({level:r||I.ERROR,type:n||A.NORMAL},e),t)},publishWsErrorLog:function(e,t){var n=e.connectUrl,r=e.msg,e=e.readyState;this.publishErrorLog({msg:"WEBSOCKET_ERROR: \n              connect: "+n+"\n              readyState: "+e+"\n              msg: "+r,level:I.WEBSOCKET_ERROR,type:A.NORMAL},t)},destroy:function(){var t,e;this.publishErrorLog=function(){},this.hackWebsocketConfig&&(t=this.hackWebsocketConfig,window.WebSocket=ct,-1!==(e=S.findIndex(function(e){return e.key===t.key})))&&S.splice(e,1)}})),ft=(new a({name:l.PAGE_PERFORMANCE}),3),pt=new a({name:l.PAGE_PERFORMANCE,performanceMap:{},onNewAegis:function(e){Ne()&&(E?this.publish(E,e):this.startCalcPerformance(e))},startCalcPerformance:function(n){var r=this;try{this.getFirstScreenTiming(n,function(e){var t=performance.timing;t&&(E={msg:"page_performance",type:A.PAGE_PERFORMANCE,dnsLookup:y(t.domainLookupEnd-t.domainLookupStart),tcp:y(t.connectEnd-t.connectStart),ssl:y(0===t.secureConnectionStart?0:t.requestStart-t.secureConnectionStart),ttfb:y(t.responseStart-t.requestStart),contentDownload:y(t.responseEnd-t.responseStart),domParse:y(t.domInteractive-t.domLoading,0,15e3,1070),resourceDownload:y(t.loadEventStart-t.domInteractive,0,15e3,1070),firstScreenTiming:y(Math.floor(e),0,15e3,15e3)},(t=n.config).extraPerformanceData&&"{}"!==JSON.stringify(t.extraPerformanceData)&&(t=(e=t.extraPerformanceData).engineInit,e=e.bundleLoad,E=C(C({},E),{engineInit:y(t,0,1e4),bundleLoad:y(e,0,1e4)})),r.publish(E,n))})}catch(n){}},getFirstScreenTiming:function(s,u){var c=this;s.event.on(v.destroy,function(){m&&clearTimeout(m)});var l,d=this,n=["script","style","link","br"],f=[],p={},h=(-1<(null==(e=null==(e=window.PerformanceObserver)?void 0:e.supportedEntryTypes)?void 0:e.indexOf("paint"))&&(l=new PerformanceObserver(function(e){e.getEntries().forEach(function(e){var t;"paint"===e.entryType&&"first-contentful-paint"===e.name&&0<(t=document.querySelectorAll("[AEGIS-FIRST-SCREEN-TIMING]")).length&&s.config.id&&!c.performanceMap[s.config.id]&&(c.setFirstScreenInfo(s,e.startTime,t[0],t),null!=u&&u(e.startTime),h.disconnect(),l.disconnect(),m)&&clearTimeout(m)})})).observe({entryTypes:["paint"]}),new MutationObserver(function(e){var t={roots:[],ignores:[],rootsDomNum:[],time:performance.now()};e.forEach(function(e){null!=e&&e.addedNodes&&Array.prototype.slice.call(e.addedNodes).forEach(function(e){d.isEleInArray(e,t.ignores)?t.ignores.push(e):1===e.nodeType&&e.hasAttribute("AEGIS-FIRST-SCREEN-TIMING")?(Object.prototype.hasOwnProperty.apply(p,[t.time])||(p[t.time]=[]),p[t.time].push(e)):1===e.nodeType&&(d.hasAncestorOrSelfWithAttribute(e,"AEGIS-IGNORE-FIRST-SCREEN-TIMING")?t.ignores.push(e):-1!==n.indexOf(e.nodeName.toLocaleLowerCase())||d.isEleInArray(e,t.roots)||(t.roots.push(e),t.rootsDomNum.push(d.walkAndCount(e)||0)))})}),t.roots.length&&f.push(t)}));h.observe(document,{childList:!0,subtree:!0});var e,g=function(n){(n=void 0===n?0:n)||(r=0,(e=Object.keys(p)).length?(n=Math.max.apply(null,e),c.setFirstScreenInfo(s,n,null==(e=p[n])?void 0:e[0],p)):f.forEach(function(e){for(var t=0;t<e.roots.length;t++)e.rootsDomNum[t]>r&&d.isInFirstScreen(e.roots[t])&&(r=e.rootsDomNum[t],n=e.time,c.setFirstScreenInfo(s,n,e.roots[t]))}),f.length=0,Object.keys(p).forEach(function(e){p[e]=p[e].map(function(e){var t={tagName:e.tagName},n=e.attributes;if(!n)return e;for(var r=0;r<n.length;r++){var i=n[r];i.name&&(t[i.name]=e.getAttribute(i.name))}return t})}));var r,e=performance.timing,t=e.domInteractive-e.domLoading,e=e.loadEventStart-e.domInteractive,i=n;m=null;for(var o=0,a=[t,e,i];o<a.length;o++)if(a[o]<=0&&0<ft){m=setTimeout(function(){return g(i)},3e3);break}m?--ft:(h.disconnect(),null!=l&&l.disconnect(),null!=u&&u(n))},m=setTimeout(function(){return g()},3e3)},setFirstScreenInfo:function(e,t,n,r){var i;e.config.id&&this.performanceMap[e.config.id]||(e.config.id&&(this.performanceMap[e.config.id]=!0),("object"!=typeof(null==(i=e.config)?void 0:i.pagePerformance)||null!=(i=e.config.pagePerformance)&&i.firstScreenInfo)&&(e.firstScreenInfo={element:n,timing:t,markDoms:r}))},isEleInArray:function(e,t){return!(!e||e===document.documentElement)&&(-1!==t.indexOf(e)||this.isEleInArray(e.parentElement,t))},isInFirstScreen:function(e){var t,n;return!(!e||"function"!=typeof e.getBoundingClientRect)&&(e=e.getBoundingClientRect(),t=window.innerHeight,n=window.innerWidth,0<=e.left)&&e.left<n&&0<=e.top&&e.top<t&&0<e.width&&0<e.height},walkAndCount:function(e){var t=0;if(e&&1===e.nodeType){t+=1;var n=e.children;if(null!=n&&n.length)for(var r=0;r<n.length;r++)1===n[r].nodeType&&n[r].hasAttribute("AEGIS-IGNORE-FIRST-SCREEN-TIMING")||(t+=this.walkAndCount(n[r]))}return t},hasAncestorOrSelfWithAttribute:function(e,t){for(var n=e;n&&n!==document.body;){if(n.hasAttribute(t))return!0;n=n.parentElement}return!1}}),ht=-1,gt=function(t){addEventListener("pageshow",function(e){e.persisted&&(ht=e.timeStamp,t(e))},!0)},mt=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&0<e.responseStart&&e.responseStart<performance.now())return e},vt=function(){var e=mt();return e&&e.activationStart||0},yt=function(e,t,n){try{var r;if(PerformanceObserver.supportedEntryTypes.includes(e))return(r=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})})).observe(Object.assign({type:e,buffered:!0},n||{})),r}catch(e){}},wt=-1,bt=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},Et=function(e){"hidden"===document.visibilityState&&-1<wt&&(wt="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("visibilitychange",Et,!0),removeEventListener("prerenderingchange",Et,!0))},Tt=function(){addEventListener("visibilitychange",Et,!0),addEventListener("prerenderingchange",Et,!0)},St=[1800,3e3],Rt=[.1,.25],Ot=0,Ct=1/0,It=0,At=function(e){e.forEach(function(e){e.interactionId&&(Ct=Math.min(Ct,e.interactionId),It=Math.max(It,e.interactionId),Ot=It?(It-Ct)/7+1:0)})},R=[],Pt=new Map,xt=0,Bt=[],Nt=[200,500],Lt=[2500,4e3],Mt={},_t={passive:!0,capture:!0},kt=new Date,Dt=function(e,t){T||(T=t,nt=e,rt=new Date,$e(removeEventListener),Ze())},Ht=[100,300],Gt=(new a({name:l.WEB_VITALS}),{FCP:-1,LCP:-1,FID:-1,CLS:-1,INP:-1}),Ft=new a({name:l.WEB_VITALS,onNewAegis:function(e){if(Ne()&&"function"==typeof window.PerformanceObserver&&"function"==typeof performance.getEntriesByName)try{Ve(et),l=et,d={},Xe(function(){function e(e){(e=d.reportAllChanges?e:e.slice(-1)).forEach(function(e){e.startTime<r.firstHiddenTime&&(i.value=Math.max(e.startTime-vt(),0),i.entries=[e],t())})}var t,n,r=We(),i=w("LCP"),o=yt("largest-contentful-paint",e);o&&(t=b(l,i,Lt,d.reportAllChanges),n=je(function(){Mt[i.id]||(e(o.takeRecords()),o.disconnect(),Mt[i.id]=!0,t(!0))}),["keydown","click"].forEach(function(e){addEventListener(e,function(){return Je(n)},{once:!0,capture:!0})}),qe(n),gt(function(e){i=w("LCP"),t=b(l,i,Lt,d.reportAllChanges),Ue(function(){i.value=performance.now()-e.timeStamp,Mt[i.id]=!0,t(!0)})}))}),u=et,c={},Xe(function(){function t(e){e.startTime<n.firstHiddenTime&&(r.value=e.processingStart-e.startTime,r.entries.push(e),o(!0))}function e(e){e.forEach(t)}var n=We(),r=w("FID"),i=yt("first-input",e),o=b(u,r,Ht,c.reportAllChanges);i&&(qe(je(function(){e(i.takeRecords()),i.disconnect()})),gt(function(){r=w("FID"),o=b(u,r,Ht,c.reportAllChanges),it=[],nt=-1,T=null,$e(addEventListener),it.push(t),Ze()}))}),a=et,s={},Ve(je(function(){function e(e){e.forEach(function(e){var t,n;e.hadRecentInput||(t=i[0],n=i[i.length-1],r&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(r+=e.value,i.push(e)):(r=e.value,i=[e]))}),r>n.value&&(n.value=r,n.entries=i,t())}var t,n=w("CLS",0),r=0,i=[],o=yt("layout-shift",e);o&&(t=b(a,n,Rt,s.reportAllChanges),qe(function(){e(o.takeRecords()),t(!0)}),gt(function(){n=w("CLS",r=0),t=b(a,n,Rt,s.reportAllChanges),Ue(function(){return t()})}),setTimeout(t,0))})),Ye(et),Le(this.publishVitals.bind(this,e),!0)}catch(e){}var a,s,u,c,l,d},publishVitals:function(e){var t=this;setTimeout(function(){t.publish(C({type:A.WEB_VITALS,msg:"web_vitals"},Gt),e)},10)},destroy:function(){this.publish=function(){}}}),Ut=(new a({name:l.SPA}),["replaceState","pushState","popstate","hashchange"]),qt=new a({name:l.SPA,originFireUrl:"",onNewAegis:function(t){var e,n=this;history.pushState=this.wr("pushState")||history.pushState,history.replaceState=this.wr("replaceState")||history.replaceState,this.sendPv=this.sendPv.bind(this),null!=(e=null==(e=t.config)?void 0:e.plugin)&&e.spa&&this.sendPv(t),Ut.forEach(function(e){return window.addEventListener(e,function(){return n.sendPv.call(n,t)})})},wr:function(n){var r=history[n],e="__"+n+"__hasWrittenByTamSpa";return"function"==typeof r&&!history[e]&&(Object.defineProperty(history,e,{value:!0,enumerable:!1}),function(){var e=r.apply(this,arguments),t=null;return"function"==typeof Event?t=new Event(n):(t=document.createEvent("HTMLEvents")).initEvent(n,!1,!0),window.dispatchEvent(t),e})},sendPv:function(t){var n=this;setTimeout(function(){var e=location.pathname+location.hash+t.config.id;e&&e!==t.originFireUrl&&(t.extendBean({from:t.getCurrentPageUrl()}),n.publish({msg:"spa",type:A.PV},t),t.originFireUrl=e)},0)},destroy:function(){this.sendPv=function(){}}}),jt={name:"networkRefresh",create:function(r){return function(t,n){ut(function(e){r.extendBean({netType:e}),n(t)})}}},o=(G(at=O,o=ot=o),at.prototype=null===o?Object.create(o):(Wt.prototype=o.prototype,new Wt),O.prototype.getCurrentPageUrl=function(){var e=this.config.pageUrl||location.href||"";return(e="function"==typeof this.config.urlHandler?this.config.urlHandler():e).slice(0,2048)},O.prototype.ready=function(){function o(){var e,n,r,i;t.reportRequestQueue.length&&(e=t.reportRequestQueue.splice(0,1)[0],n=e.options,r=e.success,i=e.fail,t.$request(n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return null==r?void 0:r.apply(n,e)}finally{o()}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return null==i?void 0:i.apply(n,e)}finally{o()}}))}var t=this;o(),this.isReportReady=!0},O.prototype.request=function(e,t,n){this.config.reportImmediately||this.isReportReady?this.$request(e,t,n):this.reportRequestQueue.push({options:e,success:t,fail:n})},O.prototype.$request=function(e,t,n){var r,i,o,a,s,u,c,l;if(e&&this.bean.id)return o=e.url,r=e.payload,e=e.method,(o=o||x(this.config,"hostUrl.url"))?((i=this.config.onBeforeRequest)&&(c=V.ON_BEFORE_REQUEST,l=X.ON_BEFORE_SEND,console.warn("[Aegis] "+c+"方法已过期，请使用新的方法 "+l),r=i(r,this)),r?void(this.sendNow&&"function"==typeof(null===navigator||void 0===navigator?void 0:navigator.sendBeacon)?navigator.sendBeacon(o,JSON.stringify(r)):(l=(c={url:o,payload:r,method:e,success:t,fail:n}).url,i=c.method,o=c.payload,a=c.fail,s=c.success,(u=new XMLHttpRequest).sendByAegis=!0,u.addEventListener("readystatechange",function(){4===u.readyState&&(400<=u.status||0===u.status?null!=a&&a(u.response):null!=s&&s(u.response))}),u.open(i||"post",l),_e()&&u.setRequestHeader("content-type","text/plain;charset=UTF-8"),u.send(JSON.stringify(o)))):console.warn("Sending request blocked")):console.warn("url is empty");this.logger.error("参数错误或者没有项目ID，不让发请求")},O.sessionID="session-"+Date.now(),O);function O(t){t=ot.call(this,t)||this;t.sendNow=!1,t.originFireUrl="",t.isReportReady=!1,t.reportRequestQueue=[],t.pipes.push(jt);try{t.init(),t.extendBean({from:t.getCurrentPageUrl()}),"undefined"!=typeof document&&t.extendBean({referer:document.referrer||""})}catch(e){t.logger.warn(e),t.sendSDKError({msg:f(e)})}return t}function Wt(){this.constructor=at}new a({name:l.IE});function B(e){return-1!==Xt.indexOf(e)}var Xt=window.navigator.userAgent.toLowerCase(),N={};N.macos=function(){return B("mac")},N.ios=function(){return N.iphone()||N.ipod()||N.ipad()},N.iphone=function(){return!N.windows()&&B("iphone")},N.ipod=function(){return B("ipod")},N.ipad=function(){var e="MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;return B("ipad")||e},N.android=function(){return!N.windows()&&B("android")},N.androidPhone=function(){return N.android()&&B("mobile")},N.androidTablet=function(){return N.android()&&!B("mobile")},N.blackberry=function(){return B("blackberry")||B("bb10")},N.blackberryPhone=function(){return N.blackberry()&&!B("tablet")},N.blackberryTablet=function(){return N.blackberry()&&B("tablet")},N.windows=function(){return B("windows")},N.windowsPhone=function(){return N.windows()&&B("phone")},N.windowsTablet=function(){return N.windows()&&B("touch")&&!N.windowsPhone()},N.fxos=function(){return(B("(mobile")||B("(tablet"))&&B(" rv:")},N.fxosPhone=function(){return N.fxos()&&B("mobile")},N.fxosTablet=function(){return N.fxos()&&B("tablet")},N.meego=function(){return B("meego")},N.cordova=function(){return window.cordova&&"file:"===location.protocol},N.nodeWebkit=function(){return"object"==typeof window.process},N.mobile=function(){return N.androidPhone()||N.iphone()||N.ipod()||N.windowsPhone()||N.blackberryPhone()||N.fxosPhone()||N.meego()},N.tablet=function(){return N.ipad()||N.androidTablet()||N.blackberryTablet()||N.windowsTablet()||N.fxosTablet()},N.desktop=function(){return!N.tablet()&&!N.mobile()},N.isIE=function(){return"ActiveXObject"in window},new a({name:l.CLOSE});function Vt(e){for(var t=3&e.length,n=e.length-t,r=1,i=3432918353,o=461845907,a=0;a<n;){var s=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24;++a;r=27492+(65535&(s=5*(65535&(r=(r^=(65535&(s=(s=(65535&s)*i+(((s>>>16)*i&65535)<<16)&4294967295)<<15|s>>>17))*o+(((s>>>16)*o&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16)}var u=0;switch(t){case 3:u^=(255&e.charCodeAt(a+2))<<16;case 2:u^=(255&e.charCodeAt(a+1))<<8;case 1:r^=u=(65535&(u=(u=(65535&(u^=255&e.charCodeAt(a)))*i+(((u>>>16)*i&65535)<<16)&4294967295)<<15|u>>>17))*o+(((u>>>16)*o&65535)<<16)&4294967295}r=2246822507*(65535&(r=(r^=e.length)^r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295;for(var c=(r^=r>>>16)>>>0,l=(c%2).toString();1<c;)l=(c=parseInt((c/2).toString(),10))%2+l;for(;l.length<32;)l="0"+l;return l}function Kt(){var e,u,i,t=document.createElement("canvas");return((e=t.getContext("2d"))?(e.font="14px 'Arial'",e.textBaseline="alphabetic",e.fillStyle="#f60",e.fillRect(125,1,62,20),e.fillStyle="#069",e.fillText("aegis,sdk <canvas> 1.0",2,15),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillText("aegis,sdk <canvas> 1.0",4,17),t.toDataURL("image/jpeg")):"")+(u=["monospace","sans-serif","serif"],i=["default","sans-serif","serif","monospace","Apple LiSung","Apple SD Gothic Neo","Apple Symbols","Baoli SC, Baoli TC","Baskerville","Beirut","GungSeo","Gurmukhi MN","Gurmukhi MT","Hannotate SC, Hannotate TC","HanziPen SC, HanziPen TC","HeadlineA","Hei","LiSong Pro","Libian SC, Libian TC","LingWai SC, LingWai TC","Lucida Grande","Luminari","Nanum Brush Script","Nanum Gothic, NanumGothic","Nanum Myeongjo, NanumMyeongjo","Nanum Pen Script","NanumGothic ExtraBold, NanumGothicExtraBold","New Peninim MT","Noto Serif Kannada","Noto Serif Myanmar","Optima","PilGi","Plantagenet Cherokee","Raanana","STFangSong, STFangsong","STHeiti","STIXGeneral, STIXGeneral-Regular","Tsukushi B Round Gothic, Tsukushi B Round Gothic Regular","Tsukushi B Round Gothic Bold","Verdana","Waseem","Xingkai SC, Xingkai TC","YuGothic, YuGothic Medium","YuGothic Bold","Yuanti SC, Yuanti TC","Yuppy SC, Yuppy TC","Zapf Dingbats","Andale Mono","Arial","Arial Black","Arial Hebrew","Arial MT","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Bitstream Vera Sans Mono","Book Antiqua","Bookman Old Style","Calibri","Cambria","Cambria Math","Century","Century Gothic","Century Schoolbook","Comic Sans","Comic Sans MS","Consolas","Courier","Courier New","Geneva","Georgia","Helvetica","Helvetica Neue","Impact","Lucida Bright","Lucida Calligraphy","Lucida Console","Lucida Fax","LUCIDA GRANDE","Lucida Handwriting","Lucida Sans","Lucida Sans Typewriter","Lucida Sans Unicode","Microsoft Sans Serif","Monaco","Monotype Corsiva","MS Gothic","MS Outlook","MS PGothic","MS Reference Sans Serif","MS Sans Serif","MS Serif","MYRIAD","MYRIAD PRO","Palatino","Palatino Linotype","Segoe Print","Segoe Script","Segoe UI","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","Tahoma","Times","Times New Roman","Times New Roman PS","Trebuchet MS","Verdana","Wingdings","Wingdings 2","Wingdings 3","Abadi MT Condensed Light","Academy Engraved LET","ADOBE CASLON PRO","Adobe Garamond","ADOBE GARAMOND PRO","Agency FB","Aharoni","Albertus Extra Bold","Albertus Medium","Algerian","Amazone BT","American Typewriter","American Typewriter Condensed","AmerType Md BT","Andalus","Angsana New","AngsanaUPC","Antique Olive","Aparajita","Apple Chancery","Apple Color Emoji","Apple SD Gothic Neo","Arabic Typesetting","ARCHER","ARNO PRO","Arrus BT","Aurora Cn BT","AvantGarde Bk BT","AvantGarde Md BT","AVENIR","Ayuthaya","Bandy","Bangla Sangam MN","Bank Gothic","BankGothic Md BT","Baskerville","Baskerville Old Face","Batang","BatangChe","Bauer Bodoni","Bauhaus 93","Bazooka","Bell MT","Bembo","Benguiat Bk BT","Berlin Sans FB","Berlin Sans FB Demi","Bernard MT Condensed","BernhardFashion BT","BernhardMod BT","Big Caslon","BinnerD","Blackadder ITC","BlairMdITC TT","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bodoni MT","Bodoni MT Black","Bodoni MT Condensed","Bodoni MT Poster Compressed","Bookshelf Symbol 7","Boulder","Bradley Hand","Bradley Hand ITC","Bremen Bd BT","Britannic Bold","Broadway","Browallia New","BrowalliaUPC","Brush Script MT","Californian FB","Calisto MT","Calligrapher","Candara","CaslonOpnface BT","Castellar","Centaur","Cezanne","CG Omega","CG Times","Chalkboard","Chalkboard SE","Chalkduster","Charlesworth","Charter Bd BT","Charter BT","Chaucer","ChelthmITC Bk BT","Chiller","Clarendon","Clarendon Condensed","CloisterBlack BT","Cochin","Colonna MT","Constantia","Cooper Black","Copperplate","Copperplate Gothic","Copperplate Gothic Bold","Copperplate Gothic Light","CopperplGoth Bd BT","Corbel","Cordia New","CordiaUPC","Cornerstone","Coronet","Cuckoo","Curlz MT","DaunPenh","Dauphin","David","DB LCD Temp","DELICIOUS","Denmark","DFKai-SB","Didot","DilleniaUPC","DIN","DokChampa","Dotum","DotumChe","Ebrima","Edwardian Script ITC","Elephant","English 111 Vivace BT","Engravers MT","EngraversGothic BT","Eras Bold ITC","Eras Demi ITC","Eras Light ITC","Eras Medium ITC","EucrosiaUPC","Euphemia","Euphemia UCAS","EUROSTILE","Exotc350 Bd BT","FangSong","Felix Titling","Fixedsys","FONTIN","Footlight MT Light","Forte","FrankRuehl","Fransiscan","Freefrm721 Blk BT","FreesiaUPC","Freestyle Script","French Script MT","FrnkGothITC Bk BT","Fruitger","FRUTIGER","Futura","Futura Bk BT","Futura Lt BT","Futura Md BT","Futura ZBlk BT","FuturaBlack BT","Gabriola","Galliard BT","Gautami","Geeza Pro","Geometr231 BT","Geometr231 Hv BT","Geometr231 Lt BT","GeoSlab 703 Lt BT","GeoSlab 703 XBd BT","Gigi","Gill Sans","Gill Sans MT","Gill Sans MT Condensed","Gill Sans MT Ext Condensed Bold","Gill Sans Ultra Bold","Gill Sans Ultra Bold Condensed","Gisha","Gloucester MT Extra Condensed","GOTHAM","GOTHAM BOLD","Goudy Old Style","Goudy Stout","GoudyHandtooled BT","GoudyOLSt BT","Gujarati Sangam MN","Gulim","GulimChe","Gungsuh","GungsuhChe","Gurmukhi MN","Haettenschweiler","Harlow Solid Italic","Harrington","Heather","Heiti SC","Heiti TC","HELV","Herald","High Tower Text","Hiragino Kaku Gothic ProN","Hiragino Mincho ProN","Hoefler Text","Humanst 521 Cn BT","Humanst521 BT","Humanst521 Lt BT","Imprint MT Shadow","Incised901 Bd BT","Incised901 BT","Incised901 Lt BT","INCONSOLATA","Informal Roman","Informal011 BT","INTERSTATE","IrisUPC","Iskoola Pota","JasmineUPC","Jazz LET","Jenson","Jester","Jokerman","Juice ITC","Kabel Bk BT","Kabel Ult BT","Kailasa","KaiTi","Kalinga","Kannada Sangam MN","Kartika","Kaufmann Bd BT","Kaufmann BT","Khmer UI","KodchiangUPC","Kokila","Korinna BT","Kristen ITC","Krungthep","Kunstler Script","Lao UI","Latha","Leelawadee","Letter Gothic","Levenim MT","LilyUPC","Lithograph","Lithograph Light","Long Island","Lydian BT","Magneto","Maiandra GD","Malayalam Sangam MN","Malgun Gothic","Mangal","Marigold","Marion","Marker Felt","Market","Marlett","Matisse ITC","Matura MT Script Capitals","Meiryo","Meiryo UI","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Tai Le","Microsoft Uighur","Microsoft YaHei","Microsoft Yi Baiti","MingLiU","MingLiU_HKSCS","MingLiU_HKSCS-ExtB","MingLiU-ExtB","Minion","Minion Pro","Miriam","Miriam Fixed","Mistral","Modern","Modern No. 20","Mona Lisa Solid ITC TT","Mongolian Baiti","MONO","MoolBoran","Mrs Eaves","MS LineDraw","MS Mincho","MS PMincho","MS Reference Specialty","MS UI Gothic","MT Extra","MUSEO","MV Boli","Nadeem","Narkisim","NEVIS","News Gothic","News GothicMT","NewsGoth BT","Niagara Engraved","Niagara Solid","Noteworthy","NSimSun","Nyala","OCR A Extended","Old Century","Old English Text MT","Onyx","Onyx BT","OPTIMA","Oriya Sangam MN","OSAKA","OzHandicraft BT","Palace Script MT","Papyrus","Parchment","Party LET","Pegasus","Perpetua","Perpetua Titling MT","PetitaBold","Pickwick","Plantagenet Cherokee","Playbill","PMingLiU","PMingLiU-ExtB","Poor Richard","Poster","PosterBodoni BT","PRINCETOWN LET","Pristina","PTBarnum BT","Pythagoras","Raavi","Rage Italic","Ravie","Ribbon131 Bd BT","Rockwell","Rockwell Condensed","Rockwell Extra Bold","Rod","Roman","Sakkal Majalla","Santa Fe LET","Savoye LET","Sceptre","Script","Script MT Bold","SCRIPTINA","Serifa","Serifa BT","Serifa Th BT","ShelleyVolante BT","Sherwood","Shonar Bangla","Showcard Gothic","Shruti","Signboard","SILKSCREEN","SimHei","Simplified Arabic","Simplified Arabic Fixed","SimSun","SimSun-ExtB","Sinhala Sangam MN","Sketch Rockwell","Skia","Small Fonts","Snap ITC","Snell Roundhand","Socket","Souvenir Lt BT","Staccato222 BT","Steamer","Stencil","Storybook","Styllo","Subway","Swis721 BlkEx BT","Swiss911 XCm BT","Sylfaen","Synchro LET","System","Tamil Sangam MN","Technical","Teletype","Telugu Sangam MN","Tempus Sans ITC","Terminal","Thonburi","Traditional Arabic","Trajan","TRAJAN PRO","Tristan","Tubular","Tunga","Tw Cen MT","Tw Cen MT Condensed","Tw Cen MT Condensed Extra Bold","TypoUpright BT","Unicorn","Univers","Univers CE 55 Medium","Univers Condensed","Utsaah","Vagabond","Vani","Vijaya","Viner Hand ITC","VisualUI","Vivaldi","Vladimir Script","Vrinda","Westminster","WHITNEY","Wide Latin","ZapfEllipt BT","ZapfHumnst BT","ZapfHumnst Dm BT","Zapfino","Zurich BlkEx BT","Zurich Ex BT","ZWAdobeF"],function(){for(var e=function(){var e,i=document.getElementsByTagName("head")[0],o=document.createElement("span"),a=(o.style.fontSize="72px",o.innerHTML="mmmmmmmmmmlli",{}),s={};for(e in u)o.style.fontFamily=u[e],i.appendChild(o),a[u[e]]=o.offsetWidth,s[u[e]]=o.offsetHeight,i.removeChild(o);return{detect:function(e){var t,n=!1;for(t in u){o.style.fontFamily=e+","+u[t],i.appendChild(o);var r=o.offsetWidth!==a[u[t]]||o.offsetHeight!==s[u[t]];i.removeChild(o),n=n||r}return n}}}(),t=i,n="",r=0;r<t.length;r++)n+=e.detect(t[r])?"1":"0";return n}())+function(){var e=document.createElement("canvas"),s=(e.width=256,e.height=128,e.getContext("webgl2")||e.getContext("experimental-webgl2")||e.getContext("webgl")||e.getContext("experimental-webgl")||e.getContext("moz-webgl")),t=function(){var e="";try{var t=s.createBuffer(),n=(s.bindBuffer(s.ARRAY_BUFFER,t),new Float32Array([-.2,-.9,0,.4,-.26,0,0,.7321,0])),r=(s.bufferData(s.ARRAY_BUFFER,n,s.STATIC_DRAW),t.itemSize=3,t.numItems=3,s.createProgram()),i=s.createShader(s.VERTEX_SHADER),o=(s.shaderSource(i,"attribute vec2 attrVertex;varying vec2 varyinTexCoordinate;uniform vec2 uniformOffset;void main(){varyinTexCoordinate=attrVertex+uniformOffset;gl_Position=vec4(attrVertex,0,1);}"),s.compileShader(i),s.createShader(s.FRAGMENT_SHADER)),a=(s.shaderSource(o,"precision mediump float;varying vec2 varyinTexCoordinate;void main() {gl_FragColor=vec4(varyinTexCoordinate,0,1);}"),s.compileShader(o),s.attachShader(r,i),s.attachShader(r,o),s.linkProgram(r),s.useProgram(r),r.vertexPosAttrib=s.getAttribLocation(r,"attrVertex"),r.offsetUniform=s.getUniformLocation(r,"uniformOffset"),s.enableVertexAttribArray(r.vertexPosArray),s.vertexAttribPointer(r.vertexPosAttrib,t.itemSize,s.FLOAT,!1,0,0),s.uniform2f(r.offsetUniform,1,1),s.drawArrays(s.TRIANGLE_STRIP,0,t.numItems),new Uint8Array(131072));s.readPixels(0,0,256,128,s.RGBA,s.UNSIGNED_BYTE,a),e=JSON.stringify(a).replace(/,?"[0-9]+":/g,"")}catch(e){console.warn("fAid error: getwebGlHash-getWebglImageHash",e)}return e}(),n=function(){var e="";try{var t=null==s?void 0:s.getExtension("WEBGL_debug_renderer_info"),e=(null==s?void 0:s.getParameter(t.UNMASKED_VENDOR_WEBGL))+(null==s?void 0:s.getParameter(t.UNMASKED_RENDERER_WEBGL))}catch(e){console.warn("fAid error: getwebGlHash-getWebglReportHash-vendor&renderer info",e)}var n,r,t="";try{var i=function(e){return s.clearColor(0,0,0,1),s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),"["+e[0]+", "+e[1]+"]"},o=[];o.push("extensions:"+(s.getSupportedExtensions()||[]).join(";")),o.push("webgl aliased line width range:"+i(s.getParameter(s.ALIASED_LINE_WIDTH_RANGE))),o.push("webgl aliased point size range:"+i(s.getParameter(s.ALIASED_POINT_SIZE_RANGE))),o.push("webgl alpha bits:"+s.getParameter(s.ALPHA_BITS)),o.push("webgl antialiasing:"+(s.getContextAttributes().antialias?"yes":"no")),o.push("webgl blue bits:"+s.getParameter(s.BLUE_BITS)),o.push("webgl depth bits:"+s.getParameter(s.DEPTH_BITS)),o.push("webgl green bits:"+s.getParameter(s.GREEN_BITS)),o.push("webgl max anisotropy:"+((r=(n=s).getExtension("EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic"))?0===(n=n.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT))?2:n:null)),o.push("webgl max combined texture image units:"+s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS)),o.push("webgl max cube map texture size:"+s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE)),o.push("webgl max fragment uniform vectors:"+s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS)),o.push("webgl max render buffer size:"+s.getParameter(s.MAX_RENDERBUFFER_SIZE)),o.push("webgl max texture image units:"+s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS)),o.push("webgl max texture size:"+s.getParameter(s.MAX_TEXTURE_SIZE)),o.push("webgl max varying vectors:"+s.getParameter(s.MAX_VARYING_VECTORS)),o.push("webgl max vertex attribs:"+s.getParameter(s.MAX_VERTEX_ATTRIBS)),o.push("webgl max vertex texture image units:"+s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS)),o.push("webgl max vertex uniform vectors:"+s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS)),o.push("webgl max viewport dims:"+i(s.getParameter(s.MAX_VIEWPORT_DIMS))),o.push("webgl red bits:"+s.getParameter(s.RED_BITS)),o.push("webgl renderer:"+s.getParameter(s.RENDERER)),o.push("webgl shading language version:"+s.getParameter(s.SHADING_LANGUAGE_VERSION)),o.push("webgl stencil bits:"+s.getParameter(s.STENCIL_BITS)),o.push("webgl vendor:"+s.getParameter(s.VENDOR)),t=o.join("*")||""}catch(e){console.warn("fAid error: getwebGlHash-getWebglReportHash-vendor&renderer info",e)}return e+t}(),r="";try{r=Vt(t+n)}catch(e){console.warn("fAid error: getwebGlHash-hashTo32",e)}return r}()}function zt(l,d){void 0===d&&(d=/\.flv(\?|$)/i),M.find(function(e){return e.name===l.name})||(M.push(l),!sn&&window.fetch&&(sn=!0,$t=window.fetch,window.fetch=function(e,i){void 0===i&&(i={});var o="string"==typeof(a=e)?a:a instanceof Request?a.url:a instanceof URL?a.href:"";if(null!=(a=null==d?void 0:d.test)&&a.call(d,o))return $t(o,i);an.test(o)&&(o=""+location.origin+o);var n,t,r,a=(l||{}).traceRequestHeader;a&&(t=((null==i?void 0:i.headers)instanceof Headers?(t=null==i?void 0:i.headers.entries(),n={},Array.from(t).forEach(function(e){var t=e[0],e=e[1];n[t]=e}),n):null==i?void 0:i.headers)||{},r=(a=a.generate(o,t)||{}).name,a=a.value)&&r&&(i.headers=Object.assign(t,((t={})[r]=a,t)));for(var s=0;s<M.length;s++){var u=M[s];try{"function"==typeof u.beforeFetch&&u.beforeFetch(o,i)}catch(e){}}var c=Date.now();return $t(e,i).then(function(e){for(var t=e.clone(),n=0;n<M.length;n++){var r=M[n];try{"function"==typeof r.then&&r.then(t,Date.now()-c,o,i)}catch(e){}}return t}).catch(function(e){for(var t=0;t<M.length;t++){var n=M[t];try{"function"==typeof n.catch&&n.catch(e,Date.now()-c,o,i)}catch(e){}}throw e})}))}function Jt(r,e,i){return null!=e&&e.length&&"object"==typeof r?e.reduce(function(e,t){var n=r instanceof Headers?r.get(t):r[t];return n?e+(""===e?"\n":"\n\n")+i+" header "+t+": "+n:e},""):""}var Yt,Zt,Qt,$t,en,tn=new a({name:l.CLOSE,onNewAegis:function(n){var r,i=this;N.desktop()?(r=window.onunload,window.onunload=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.publishNotReportedLog(n),null!=r&&r.call.apply(r,U([window],e))}):Le(this.publishNotReportedLog.bind(this,n),!0)},publishNotReportedLog:function(e){e.clearPluginCache(),e.clearThrottleCache()},publishThrottlePipeLogs:function(){}}),nn=(new a({name:l.F_ID}),new a({name:l.F_ID,aid:"",init:function(e){try{var t=e.config.fId,n="boolean"!=typeof t&&t;n||(n=function(){try{var e=(o=window.navigator).userAgent+"*"+o.platform+(i=window.screen).width+"*"+i.height+window.screen.colorDepth+((r=null==(r=window.Intl)?void 0:r.DateTimeFormat)?null==(r=null==(r=new r)?void 0:r.resolvedOptions())?void 0:r.timeZone:"")+" + "+(new Date).getTimezoneOffset()+function(){function e(){return 0}var t=Math;try{var n=t.acos||e,r=t.acosh||e,i=t.asin||e,o=t.asinh||e,a=t.atanh||e,s=t.atan||e,u=t.sin||e,c=t.sinh||e,l=t.cos||e,d=t.cosh||e,f=t.tan||e,p=t.tanh||e,h=t.exp||e,g=t.expm1||e,m=t.log1p||e,v={acos:n(.12312423423423424),acosh:r(1e308),acoshPf:t.log(1e154+t.sqrt(1e308)),asin:i(.12312423423423424),asinh:o(1),asinhPf:t.log(1+t.sqrt(2)),atanh:a(.5),atanhPf:t.log(3)/2,atan:s(.5),sin:u(-1e300),sinh:c(1),sinhPf:t.exp(1)-1/t.exp(1)/2,cos:l(10.000000000123),cosh:d(1),coshPf:(t.exp(1)+1/t.exp(1))/2,tan:f(-1e300),tanh:p(1),tanhPf:(t.exp(2)-1)/(t.exp(2)+1),exp:h(1),expm1:g(1),expm1Pf:t.exp(1)-1,log1p:m(10),log1pPf:t.log(11),powPI:t.pow(t.PI,-100)};return Object.values(v).join("*")}catch(e){return""}}()+Kt();return t=Vt(e),n=0,"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".split("").map(function(e){return"x"===e?t[n++]:e}).join("")}catch(e){console.warn(e)}var t,n,r,i,o;return""}()||q(),window.localStorage.setItem("AEGIS_FINGER_ID",n)),this.fId=n}catch(e){console.warn(e)}},onNewAegis:function(e){e.bean.fId=this.fId,e.config.fId=this.fId}})),rn=new a({name:l.PV,init:function(e){var t;null!=(t=null==(t=e.config)?void 0:t.plugin)&&t.spa||this.publish({msg:"pv",type:A.PV},e)}}),on=!1,L=[],an=/^\/[^/]/,sn=!1,M=[],un=(new a({name:l.API}),new a({name:l.API,pipes:["repeatLimit","networkRefresh"],override:!1,onNewAegis:function(e){var t,n=((null==(n=null==e?void 0:e.config)?void 0:n.plugin)||{}).api;null!=n&&n.injectTraceHeader&&(this.traceRequestHeader=new re(n.injectTraceHeader,null!=(t=null==n?void 0:n.injectTraceIgnoreUrls)?t:[],null==n?void 0:n.injectTraceUrls)),this.overrideFetch(e.config,e),this.overrideXhr(e.config,e)},getRequestType:function(e,t,n){void 0===t&&(t="");var r,e=null==(e=e.plugin)?void 0:e.api,e="function"==typeof(null==e?void 0:e.resourceTypeHandler)?null==e?void 0:e.resourceTypeHandler(n):"";return-1===Y.indexOf(e)&&(r=void 0===t?"":t,t=(void 0===n?"":n).split("?")[0],e=ge.test(t)||he.some(function(e){return-1!==String(r).indexOf(e)})?"static":"fetch"),e},overrideFetch:function(v,y){var w=this,e=((null==v?void 0:v.plugin)||{}).api,e={name:v.id,traceRequestHeader:null!=e&&e.injectTraceHeader?this.traceRequestHeader:null,then:function(f,p,h,g){var e,m;P(h,x(v,"hostUrl.url"))||(e=f.headers?f.headers.get("content-type"):"","fetch"===(m=w.getRequestType(v,e,h))&&f.clone().text().then(function(e){var r=f.status<=0||400<=f.status,t=null==(t=v.plugin)?void 0:t.api,n=(null==t?void 0:t.reqHeaders)||[],i=Jt(null==g?void 0:g.headers,n,"req"),n=(null==t?void 0:t.resHeaders)||[],o=Jt(f.headers,n,"res"),n=te(null==g?void 0:g.headers),a=n[0],s=n[1],n=function(e,t,n){var r,i;try{if("function"==typeof(null==t?void 0:t.retCodeHandler))return{code:void 0===(o=(i=t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx,null==n?void 0:n.payload)||{}).code)?"unknown":o,isErr:i.isErr};if(!(e="string"==typeof e?JSON.parse(e):e))return{code:"unknown",isErr:!1};"function"==typeof(null==(r=null==t?void 0:t.ret)?void 0:r.join)&&(me=[].concat(t.ret.map(function(e){return e.toLowerCase()})));var o,a=Object.getOwnPropertyNames(e).filter(function(e){return-1!==me.indexOf(e.toLowerCase())});return a.length?{code:""+(o="未知"!==(o=e[a[0]])&&""!==o?o:"unknown"),isErr:0!==o&&"0"!==o&&"unknown"!==o}:{code:"unknown",isErr:!1}}catch(e){return{code:"unknown",isErr:!1}}}(e,t,{url:h,ctx:f,payload:null==g?void 0:g.body}),u=n.code,c=n.isErr,n=null==t?void 0:t.apiDetail,l=n?se(null==g?void 0:g.body,null==t?void 0:t.reqParamHandler,{url:h}):"",d=n?se(e,null==t?void 0:t.resBodyHandler,{url:h,ctx:f}):"";setTimeout(function(){var e=w.getPerformanceEntryByUrl(v,{url:h,duration:p,requestType:m,status:f.status||0,method:(null==g?void 0:g.method)||"get"}),t=e.nextHopProtocol,e=e.performanceTiming,n=""+(r?"FETCH_ERROR":le(h,d,f.status,u));w.publish(C(C({},e),{msg:n,errorMsg:r||c?h+","+u:void 0,url:h,status:f.status,method:(null==g?void 0:g.method)||"get",ret:u,isErr:c,param:l,data:d,reqHeaders:i,resHeaders:o,level:r?I.AJAX_ERROR:c?I.ERROR:I.INFO,type:A.API,trace:a,span:s,nextHopProtocol:t}),y)},0)}))},catch:function(e,i,o,a){var s,t,u,n,c,l,d;throw P(o,x(v,"hostUrl.url"))||(s=w.getRequestType(v,"",o),n=(null==(t=null==(t=v.plugin)?void 0:t.api)?void 0:t.reqHeaders)||[],u=Jt(null==a?void 0:a.headers,n,"req"),n=te(null==a?void 0:a.headers),c=n[0],l=n[1],d=null!=t&&t.apiDetail?se(null==a?void 0:a.body,null==t?void 0:t.reqParamHandler,{url:o}):"",setTimeout(function(){var e=w.getPerformanceEntryByUrl(v,{url:o,duration:i,requestType:s,status:0,method:(null==a?void 0:a.method)||"get"}),t=e.method,n=e.nextHopProtocol,e=e.performanceTiming,r="AJAX_ERROR: url: "+o+"\nresdata: \nstatus: 0\nretcode: -400\n ";w.publish(C(C({},e),{msg:r,errorMsg:o+",0",url:o,status:0,method:t,param:d,reqHeaders:u,level:I.AJAX_ERROR,type:A.API,code:-400,trace:c,span:l,nextHopProtocol:n}),y)},0)),e}};this.hackFetchOptions=e,zt(this.hackFetchOptions)},overrideXhr:function(T,S){var r,R=this,O=((null==T?void 0:T.plugin)||{}).api,e={traceRequestHeader:null!=O&&O.injectTraceHeader?this.traceRequestHeader:null,name:T.id,send:function(v,y){var e,t,n=Date.now(),w=(null!=O&&O.injectTraceHeader&&(e=(t=R.traceRequestHeader.generate(v.aegisUrl)||{}).name,t=t.value,e)&&t&&v.setRequestHeader(e,t),v.addEventListener("loadend",function(){var p,h,g,m=v.aegisUrl||"",e=!(null!=O&&O.reportAbort)&&"abort"===v.failType;P(m,x(T,"hostUrl.url"))||e||(p="",(v.failType||!v.status||400<=v.status)&&(p=v.failType||"failed"),h=Date.now()-n,e=v.getResponseHeader("content-type"),g=R.getRequestType(T,e,m),setTimeout(function(){var e,t=R.getPerformanceEntryByUrl(T,{url:m,duration:h,requestType:g,status:v.status,method:v.aegisMethod||"get"}),r=t.status,i=t.method,o=t.nextHopProtocol,a=t.performanceTiming;if("fetch"===g){var t=(null==O?void 0:O.reqHeaders)||[],s=Jt(v.aegisXhrReqHeader,t,"req"),t=(null==O?void 0:O.resHeaders)||[],n=v.getAllResponseHeaders().split("\r\n").reduce(function(e,t){t=t.split(": ");return t[0]&&t[1]&&(e[t[0]]=t[1]),e},{}),u=Jt(n,t,"res"),n=te(v.aegisXhrReqHeader),c=n[0],l=n[1],t=null==O?void 0:O.apiDetail,d=t?se(y,null==O?void 0:O.reqParamHandler,{url:m}):"",f=t?se(v.response,null==O?void 0:O.resBodyHandler,{url:m}):"";try{!function(e,t,n,r){var i,o,a,s;try{if("function"==typeof(null==t?void 0:t.retCodeHandlerAsync))return t.retCodeHandlerAsync(e,null==n?void 0:n.url,null==n?void 0:n.ctx,function(e){var t=e.code,e=e.isErr;null!=r&&r({code:void 0===t?"unknown":t,isErr:e})});if("function"==typeof(null==t?void 0:t.retCodeHandler))return a=(o=t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx,null==n?void 0:n.payload)||{}).code,s=o.isErr,null!=r&&r({code:void 0===a?"unknown":a,isErr:s});if(!(e="string"==typeof e?JSON.parse(e):e))return null!=r&&r({code:"unknown",isErr:!1});"function"==typeof(null==(i=null==t?void 0:t.ret)?void 0:i.join)&&(me=[].concat(t.ret.map(function(e){return e.toLowerCase()})));var u=Object.getOwnPropertyNames(e).filter(function(e){return-1!==me.indexOf(e.toLowerCase())});if(u.length)return"未知"!==(a=e[u[0]])&&""!==a||(a="unknown"),null!=r&&r({code:""+a,isErr:0!==a&&"0"!==a&&"unknown"!==a});null!=r&&r({code:"unknown",isErr:!1})}catch(e){null!=r&&r({code:"unknown",isErr:!1})}}(v.response,null==(e=T.plugin)?void 0:e.api,{url:m,ctx:v,payload:y},function(e){var t=e.code,e=e.isErr,n=p?"AJAX_ERROR: request "+p:le(m,f,r,t);R.publish(C(C({},a),{msg:n,url:m,status:r,method:i,param:d,data:f,reqHeaders:s,resHeaders:u,level:p?I.AJAX_ERROR:e?I.ERROR:I.INFO,ret:t,isErr:e,trace:c,span:l,type:A.API,nextHopProtocol:o}),S)})}catch(e){}}v.removeEventListener("abort",w),v.removeEventListener("error",b),v.removeEventListener("timeout",E)},0))}),function(){v.failType="abort"}),b=function(){v.failType="error"},E=function(){v.failType="timeout"};v.addEventListener("abort",w),v.addEventListener("error",b),v.addEventListener("timeout",E)}};this.hackXHROptions=e,r=this.hackXHROptions,L.find(function(e){return e.name===r.name})||(L.push(r),!on&&window.XMLHttpRequest&&(Yt=window.XMLHttpRequest.prototype.send,Zt=window.XMLHttpRequest.prototype.open,Qt=window.XMLHttpRequest.prototype.setRequestHeader,on=!0,window.XMLHttpRequest.prototype.open=function(){this.aegisMethod=arguments[0];var e=arguments[1];if(an.test(e)&&(e=""+location.origin+e),this.aegisUrl=e,this.aegisXhrStartTime=Date.now(),this.sendByAegis)N.isIE()||(this.timeout=5e3);else for(var t=0;t<L.length;t++){var n=L[t];try{"function"==typeof n.open&&n.open(this)}catch(e){}}return Zt.apply(this,arguments)},window.XMLHttpRequest.prototype.setRequestHeader=function(){var e,t=arguments[0],n=arguments[1];if(this.aegisXhrReqHeader=null!=(e=this.aegisXhrReqHeader)?e:{},!(null!=r&&r.traceRequestHeader&&-1<["traceparent","b3","sw8","sentry-trace"].indexOf(t)&&(this.aegisXhrReqHeader[t]||(arguments[1]=n),this.aegisXhrReqHeader[t])))return this.aegisXhrReqHeader[t]=arguments[1],Qt.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(!this.sendByAegis)for(var e=0;e<L.length;e++){var t=L[e];try{"function"==typeof t.send&&t.send(this,arguments[0])}catch(e){}}return Yt.apply(this,arguments)}))},getPerformanceEntryByUrl:function(e,t){if("string"==typeof t.url){var n=null==(n=performance.getEntriesByName(t.url))?void 0:n.pop();if(n)return{msg:"api",type:A.API,url:t.url,isHttps:ae(t.url),method:t.method,requestType:t.requestType,status:t.status,duration:Number(n.duration.toFixed(2)),nextHopProtocol:n.nextHopProtocol||"",performanceTiming:{preHandleTime:Number((n.fetchStart-n.domainLookupEnd).toFixed(2)),duration:Number(n.duration.toFixed(2)),domainLookup:Number((n.domainLookupEnd-n.domainLookupStart).toFixed(2)),connectTime:Number((n.connectEnd-n.connectStart).toFixed(2)),tlsTime:Number((n.requestStart-n.secureConnectionStart).toFixed(2)),tcpAndRequestGap:Number((n.requestStart-n.connectEnd).toFixed(2)),requestTime:Number((n.responseStart-n.requestStart).toFixed(2)),responseTime:Number((n.responseStart?n.responseEnd-n.responseStart:n.duration).toFixed(2))}}}return{msg:"api",type:A.API,url:t.url,isHttps:ae(t.url),method:t.method,requestType:t.requestType,status:t.status,nextHopProtocol:"",performanceTiming:{preHandleTime:s.number,duration:Number(t.duration.toFixed(2)),domainLookup:s.number,connectTime:s.number,tlsTime:s.number,tcpAndRequestGap:s.number,requestTime:s.number,responseTime:s.number}}},destroy:function(){var t,n,e;this.publish=function(){},this.hackXHROptions&&(t=this.hackXHROptions,-1!==(e=L.findIndex(function(e){return e.name===t.name})))&&L.splice(e,1),this.hackFetchOptions&&(n=this.hackFetchOptions,-1!==(e=M.findIndex(function(e){return e.name===n.name})))&&M.splice(e,1),this.override=!1}}));function cn(e,t,n){var r,i,o,a,s,u=n.before,c=n.after;return a=(r=e)[i=t],o=a,s=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return u&&u.apply(this,t),"function"==typeof o&&(e=o.apply(this,t)),c&&c.apply(this,[e]),e},r[i]=l,{stop:function(){r[i]===l?r[i]=a:s=a}};function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if("function"==typeof s)return s.apply(this,e)}}function ln(e){return function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.forEach(function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}),n}({},e)}function dn(n){return["ancestorOrigins","href","origin","protocol","host","hostname","port","pathname","search","hash","assign","reload","replace","toString"].reduce(function(e,t){return e[t]=n[t],e},{})}(gn=en=en||{}).INITIAL_LOAD="initial_load",gn.ROUTE_CHANGE="route_change";function _(){return(new Date).getTime()}function fn(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}function pn(e){var t=e.onStart,i=e.onChange,o=_e()?dn:ln;function n(){var e,t,n,r;c.href!==window.location.href&&(e=o(window.location),n=e,(t=c).pathname===n.pathname&&(r=n.hash,document.getElementById(r.substring(1))||fn(n.hash)===fn(t.hash))||(i(c,e),c=o(e)))}t();var r,a,s,u,c=o(window.location),l=(r=n,window.addEventListener("hashchange",r),function(){window.removeEventListener("hashchange",r)}),d=(a=n,s=cn(history,"pushState",{after:a}).stop,u=cn(history,"replaceState",{after:a}).stop,window.addEventListener("popstate",a),function(){s(),u(),window.removeEventListener("popstate",a)});return function(){l(),d()}}mn.prototype.subscribe=function(t){var e=this;return!this.observers.length&&this.onFirstSubscribe&&(this.onLastUnsubscribe=this.onFirstSubscribe(this)||void 0),this.observers.push(t),{unsubscribe:function(){e.observers=e.observers.filter(function(e){return t!==e}),!e.observers.length&&e.onLastUnsubscribe&&e.onLastUnsubscribe()}}},mn.prototype.notify=function(t){this.observers.forEach(function(e){return e(t)})};var hn=mn,gn=new a({name:l.SESSION,aid:"",onNewAegis:function(r){var e,t,T,S,R,n=this,i=(r.event.on(v.sampleChange,function(){Math.random()>r.sampleMap[l.SESSION]&&n.stopSessionPlugin()}),function(e,t){n.publishSessionDataWithAegis(e,t,r)}),o=function(e){function t(e){void 0===e&&(e=!1),s=_(),u=_()+9e5,o(e),i=setInterval(r,1e3)}function n(){c()?u=_()+9e5:t(!0)}function r(){c()||(a(),clearInterval(i))}var i,o=e.onCreateOrRebuild,a=e.onExpire,s=_(),u=_()+9e5,c=function(){return _()-Number(s)<144e5&&_()<Number(u)};t();var l;(l=["click","touchstart","keydown","scroll"]).forEach(function(e){return window.addEventListener.call(window,e,n,!0)});return function(){clearInterval(i),l.forEach(function(e){return window.removeEventListener.call(window,e,n)})}}({onCreateOrRebuild:function(e){r.updateSnapshootInfo({session:{id:d.generateTraceId()}}),i("session",!0),e&&(r.updateSnapshootInfo({view:{id:d.generateSpanId(),loading_type:en.INITIAL_LOAD,view_name:document.title,view_url:window.location.href,referrer:""}}),i("view",!0))},onExpire:function(){e(),r.updateSnapshootInfo({session:void 0,view:void 0,action:void 0})}}),a=pn({onStart:function(){r.updateSnapshootInfo({view:{id:d.generateSpanId(),loading_type:en.INITIAL_LOAD,view_name:document.title,view_url:window.location.href,referrer:""}}),i("view",!0)},onChange:function(e,t){var n;null!=(n=r.snapshootInfo)&&n.action&&(i("action",!1),r.updateSnapshootInfo({action:void 0})),i("view",!1),r.updateSnapshootInfo({view:{id:d.generateSpanId(),loading_type:en.ROUTE_CHANGE,view_name:document.title,view_url:t.href,referer:e.href}}),i("view",!0)}}),s=(null==(s=r.config.plugin)?void 0:s.session).actionTypes,u=function(){};function c(e){var t,s,n,i,o,r,a,u,c,l,d,f,p,h,g,m,v,y,w,b,E;T()&&(r={action_type:e.type,action_name:(h=e.target,r=[function(e){return i(e)}],s=function(e){return 100<e.length?(void 0===n&&(n=""),r=55296<=(r=(t=e).charCodeAt(99))&&r<=56319?101:100,(t.length<=r?t:""+t.slice(0,r)+n)+" [...]"):e;var t,n,r},n=function(e,t){return e.ownerDocument?e.ownerDocument.getElementById(t):null},i=function(e){if(!e.isContentEditable)return"innerText"in e?e.innerText:e.textContent},o=function(){return t=void 0===t?"labels"in HTMLInputElement.prototype:t},(p=function(e,t){for(var n=e,r=0;r<=10&&n&&!["BODY","HTML","HEAD"].includes(n.nodeName);){for(var i=0,o=t;i<o.length;i++){var a=(0,o[i])(n);if("string"==typeof a&&a.trim())return s(a.trim().replace(/\s+/g," "))}if("FORM"===n.nodeName)break;n=n.parentElement,r+=1}return""})(h,[function(r){var e;if(o()){if("labels"in r&&r.labels&&0<r.labels.length)return i(r.labels[0])}else if(r.id)return(e=r.ownerDocument&&function(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(n.htmlFor===r.id)return n}}(r.ownerDocument.querySelectorAll("label")))&&i(e);return""},function(e){if("INPUT"===e.nodeName){var t=e.getAttribute("type");if(["button","submit","reset"].includes(t||""))return e.value}return""},function(e){return["BUTTON","LABEL"].includes(e.nodeName)||"button"===e.getAttribute("role")?i(e):""},function(e){return e.getAttribute("aria-label")},function(t){var e=t.getAttribute("aria-labelledby");return e?e.split(/\s+/).map(function(e){return n(t,e)}).filter(function(e){return Boolean(e)}).map(function(e){return i(e)}).join(" "):""},function(e){return e.getAttribute("alt")},function(e){return e.getAttribute("name")},function(e){return e.getAttribute("title")},function(e){return e.getAttribute("placeholder")},function(e){return"options"in e&&0<e.options.length?i(e.options[0]):""}])||p(h,r)||""),action_target_name:null==(h=null==(p=e.target)?void 0:p.nodeName)?void 0:h.toLowerCase()},S(r),a=R,v=!1,y=setTimeout(function(){return E()},100),w=setTimeout(function(){return E()},1e4),c=function(e){clearTimeout(y),clearTimeout(u),e.isBusy||(u=setTimeout(function(){E()},100))},d=0,f=function(){c({isBusy:0<d})},e=new hn(function(e){var t;if(MutationObserver)return(t=new MutationObserver(function(){return e.notify()})).observe(document,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),function(){return t.disconnect()}}),p=new hn(function(t){var e,n,r;return"function"==typeof(null===window||void 0===window?void 0:window.PerformanceObserver)?((e=new window.PerformanceObserver(function(){t.notify()})).observe({entryTypes:["resource"]}),function(){e.disconnect()}):(n=performance.getEntriesByType("resource").length,r=setInterval(function(){var e=performance.getEntriesByType("resource");n<=e.length&&t.notify(),n=e.length},100),function(){clearInterval(r),n=0})}),h={subscribe:function(e){var r=1,t=new hn(function(n){var e=cn(XMLHttpRequest.prototype,"send",{before:function(){r+=1,this.requestIndex=r,n.notify({state:"start",requestIndex:r})},after:function(){var e=this,t=function(){e.removeEventListener("loadend",t),n.notify({state:"end",requestIndex:e.requestIndex})};this.addEventListener("loadend",t)}}).stop;return function(){return e()}}).subscribe(e),n=new hn(function(t){var e=cn(window,"fetch",{before:function(){r+=1,t.notify({state:"start",requestIndex:r})},after:function(e){e.finally(function(){t.notify({state:"end",requestIndex:r})})}}).stop;return function(){return e()}}).subscribe(e);return{unsubscribe:function(){t.unsubscribe(),n.unsubscribe()}}}},g=[e.subscribe(f),p.subscribe(f),h.subscribe(function(e){var t=e.state,e=e.requestIndex;"start"===t?(void 0===l&&(l=e),d+=1,f()):"end"!==t||void 0===l||e<l||(--d,f())})],m=cn(window,"open",{before:f}).stop,b=function(){m(),g.forEach(function(e){return e.unsubscribe()})},E=function(){v||(a(),v=!0,clearTimeout(y),clearTimeout(w),b())})}!1!==(s=void 0===s?["click"]:s)&&0!==s.length&&(t=s,T=(s={onBeforeStart:function(){var e;return!(null!=(e=r.snapshootInfo)&&e.action)},onStart:function(e){r.updateSnapshootInfo({action:C({id:d.generateSpanId()},e)}),i("action",!0)},onEnd:function(){var e;null!=(e=r.snapshootInfo)&&e.action&&(i("action",!1),r.updateSnapshootInfo({action:void 0}))}}).onBeforeStart,S=s.onStart,R=s.onEnd,t.forEach(function(e){window.addEventListener.call(window,e,c,!0)}),u=function(){t.forEach(function(e){window.removeEventListener.call(window,e,c)})},e=function(){var e=r.snapshootInfo,t=e.session,n=e.view,e=e.action;t&&i("session",!1),n&&i("view",!1),e&&i("action",!1)},window.addEventListener.call(window,"beforeunload",function(){r.sendNow=!0,e()},!0),this.stopSessionPlugin=function(){r.updateSnapshootInfo({session:void 0,view:void 0,action:void 0}),o(),a(),u()})},publishSessionDataWithAegis:function(e,t,n){this.publish({msg:e,session_type:e,is_active:t,type:A.SESSION},n)},destroy:function(){var e;null!=(e=this.stopSessionPlugin)&&e.call(this)}});function mn(e){this.onFirstSubscribe=e,this.observers=[]}return o.use(gn),o.use(nn),o.use(He),o.use(rn),o.use(dt),o.use(un),o.use(Ge),o.use(pt),o.use(Ft),o.use(st),o.use(qt),o.use(tn),o});
